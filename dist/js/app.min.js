"use strict";function DiseaseCauseStatisticsController(e,t,a,n,l){e.isMax=!1,a.pItemSelected&&(e.pItemSelected=a.pItemSelected),e.dTypes=["心力衰竭","糖尿病","肺病","肥胖症","慢性阻塞性肺病","肾病"],e.pIds=[945209345,390870343,792838150,843209388,200483967,379404302,391970840,936108059,918102054,268058664,885653512,786333707,189759502,539164696,280543278],e.getPid=function(a,n){var l=e.dTypes.indexOf(a),o=t.getPid(l).then(function(e){return e.Results});return o},e.RenderBubbleChart=function(t){function n(e){var t=0;for(var a in e)t++;return t}t||(t=a.pItemSelected),a.pItemSelected=t,d3.select("#bar").selectAll("svg").remove(),d3.select("#bubble").selectAll("svg").remove();var o={top:40,right:20,bottom:30,left:40};if(0==e.isMax){var r=.6*$(".widget-body").width(),s=600-o.top-o.bottom;$("#bar").css("height",s+"px"),$("#bubble").css("height",s+"px")}else{var s=$(".widget-body").height(),r=.6*$(".widget-body").width();$("#bar").css("height",s+"px"),$("#bubble").css("height",s+"px")}l.get('http://59.110.52.133:3010/api/transfer/?q={"path":"/usdata/riskScore","params":%7B%22Pid%22:'+t+"%7D}").success(function(e){l.get('http://59.110.52.133:3010/api/transfer/?q={"path":"/usdata/featureImportance","params":%7B%22Pid%22:'+t+"%7D}").success(function(t){function a(e){var t=e,a=[];for(var n in t)a.push({name:e[n].disease,className:n.toLowerCase(),size:t[n].risk_score});return{children:a}}void 0,void 0,void 0,void 0;var l=d3.rgb(174,238,238),i=d3.rgb(255,130,71),c=d3.interpolate(l,i),d=d3.tip().attr("class","d3-Bubbletip").offset([-10,0]).html(function(e){return"<strong>患病概率:</strong> <span style='color:white'>"+e.value.toFixed(2)+"</span>"}),u=d3.tip().attr("class","d3-Bartip").offset([0,0]).html(function(e){return"<strong>致病概率:</strong> <span style='color:white'>"+e.value.toFixed(5)+"</span>"}),g=d3.layout.pack().size([r,s]).value(function(e){return e.size}).padding(3);void 0;var p=g.nodes(a(e.Results)).filter(function(e){return!e.children});void 0;var m=p.length;void 0;for(var h=0;h<m-1;h++)if(void 0,p[h].value>p[h+1].value){var f=p[h];p[h]=p[h+1],p[h+1]=f}var v=p[m-1];void 0;var b=v.name;void 0,void 0,void 0;for(var y=[],h=0;h<t.Results[b].length-1;h++)for(var C in t.Results[b][h])y.push({variable:C,value:t.Results[b][h][C]});y.sort(function(e,t){return e.value<t.value?1:-1});var S=d3.select("#bubble").append("svg").attr("width",r).attr("height",s),k=d3.select("#bar").append("svg").attr("width",.9*r).attr("height",30*y.length+100).append("g").attr("transform","translate("+o.left+","+o.top+")").call(u);S.call(d);var x=d3.scale.linear().range([0,.55*r]),w=d3.scale.ordinal().rangeRoundBands([0,30*y.length],.1),$=d3.svg.axis().scale(w).orient("left"),D=d3.svg.axis().scale(x).orient("top").ticks(6,"%");w.domain(y.map(function(e){return e.variable})),x.domain([0,1.5*d3.max(y,function(e){return e.value})]),k.append("g").attr("class","xaxis").attr("transform","translate(0,30)").call(D),k.append("g").attr("class","yaxis").call($).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("病因"),k.selectAll(".bar").data(y).enter().append("rect").attr("class","bar").attr("transform","translate(0,30)").attr("y",function(e){return w(e.variable)}).attr("height",w.rangeBand()).attr("x",function(e){return 0}).on("mouseover",u.show).on("mouseout",u.hide).attr("width",function(e){return 0}).transition().duration(400).attr("width",function(e){return x(e.value)}).attr("fill",d3.rgb(210,180,130)),k.selectAll(".featuretext").data(y).enter().append("text").attr("class","featuretext").attr("text-anchor","right").attr("transform","translate(0,30)").attr("x",function(){return 0}).style({opacity:0,color:"white"}).transition().duration(400).style("opacity",1).attr("x",function(e){return x(e.value)}).attr("y",function(e){return w(e.variable)}).attr("dy",15).attr("dx",4).text(function(e){return e.variable});for(var I=[],h=0;h<p.length;h++)I.push(p[h].r);var P=(d3.scale.linear().domain([0,d3.max(I)]).range([0,10]),[]);for(var C in e.Results)P.push(e.Results[C].risk_score);for(var h=0;h<P.length-1;h++)for(var N=0;N<P.length-1-h;N++)if(P[N]>P[N+1]){var f=P[N];P[N]=P[N+1],P[N+1]=f}void 0;var R=0,A=d3.max(P),T=d3.scale.linear().domain([R,A]).range([0,1]),M=S.selectAll("circle").data(p);void 0;var d=d3.tip().attr("class","d3-Bubbletip").offset([0,0]).html(function(e){return"<strong>患病概率: </strong><span style='color:white;'>"+e.value.toFixed(2)+"</span>"});S.call(d),M.enter().append("circle").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).attr("r",function(e){return e.r}).attr("class","circle").attr("fill",function(e,t){var a=T(p[t].value),n=c(a);return n.toString()}).on("mouseover",d.show).on("mouseout",d.hide);var _,L=0;d3.selectAll("#bubble svg circle").each(function(e,t){var a=d3.select(this).attr("r");a>=L&&(L=a,_=d3.select(this))}),_.style({stroke:"red","stroke-width":"2px"}),void 0,M.on("click",function(e,a){d3.selectAll(".circle").style({fill:function(e,t){var a=T(p[t].value),n=c(a);return n.toString()},"stroke-width":"0px"}),d3.select(this).style({stroke:"red","stroke-width":"2px"}),d3.select("#bar").selectAll("svg").remove();for(var l=[],s=t.Results[e.name].length,a=0;a<s;a++)for(var i in t.Results[e.name][a])l.push({variable:i,value:t.Results[e.name][a][i]});l.sort(function(e,t){return e.value<t.value?1:-1});var d=d3.select("#bar").append("svg").call(u).attr("width",r).attr("height",30*l.length+100).append("g").attr("transform","translate("+o.left+","+o.top+")"),g=n(t.Results[e.name]),m=d3.scale.linear().range([0,r-100]),h=d3.scale.ordinal().rangeRoundBands([0,30*g],.1),f=d3.svg.axis().scale(h).orient("left"),v=d3.svg.axis().scale(m).orient("top").ticks(6,"%");h.domain(l.map(function(e){return e.variable})),m.domain([0,1.5*d3.max(l,function(e){return e.value})]),d.append("g").attr("class","xaxis").attr("transform","translate(0,30)").call(v),d.append("g").attr("class","yaxis").call(f).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("病因"),d.selectAll(".bar").data(l).enter().append("rect").attr("class","bar").attr("transform","translate(0,30)").attr("y",function(e){return h(e.variable)}).attr("height",h.rangeBand()).attr("x",function(e){return 0}).on("mouseover",u.show).on("mouseout",u.hide).attr("width",function(e){return 0}).transition().duration(400).attr("width",function(e){return m(e.value)}).attr("fill",d3.rgb(210,180,130)),d.selectAll(".featuretext").data(l).enter().append("text").attr("class","featuretext").attr("text-anchor","right").attr("transform","translate(0,30)").attr("x",function(){return 0}).style({opacity:0,color:"white"}).transition().duration(400).style("opacity",1).attr("x",function(e){return m(e.value)}).attr("y",function(e){return h(e.variable)}).attr("dy",15).attr("dx",4).text(function(e){return e.variable})}),S.selectAll("bubbletext").data(p).enter().append("text").attr("class","bubbletext").attr("x",function(e){return e.x}).attr("y",function(e){return e.y}).attr("text-anchor","middle").text(function(e){return e.name}).style("opacity",function(e){return 0==e.r?0:1}).attr("font-size",function(e){return e.name.length<5?e.r/e.name.length+"px":1.6*e.r/e.name.length+"px"})}).error(function(e){void 0})}).error(function(e){void 0})},a.pageLoading=!1}function GraphQueryController(e,t,a,n,l,o,r,s){var i=t,c=a,d=["dis","sym","lab","med"],u=e.vm={};u.fclasses=i,u.fbodies=c,u.disClasses=n,u.labClasses=l,u.medClasses=o,u.options=[{label:"AND"},{label:"NOT"}];for(var g=0;g<4;g++)u[d[g]+"Option_0"]={label:"AND"};e.$watch("vm.fclass",function(){u.sclass=null}),e.$watch("vm.fbody",function(){u.sbody=null}),u.isItemsLoading={},u.itemsReturn={},u.getStates=function(e,t,a,n,l,o,i){s.errorModal.unneededAPI.apiTimestamp=0,u.isItemsLoading[e+"ItemsLoading_"+t]=!0,u.itemsReturn[e+"_"+t]=[];var c={filterbydomain:e,filterbyfirst:a||"",filterbyfclass:"",filterbysclass:"",filterbyfbody:"",filterbysbody:"",filterbynumber:"10"};n&&(c.filterbyfclass=n.label),l&&(c.filterbysclass=l.label),o&&(c.filterbyfbody=o.label),i&&(c.filterbysbody=i.label);var d=r.getFilterData(c).then(function(a){for(var n=0;n<a.elements.length;n++)a.elements[n].ename?u.itemsReturn[e+"_"+t].push({label:a.elements[n].name+"("+a.elements[n].ename+")",value:a.elements[n].value}):u.itemsReturn[e+"_"+t].push({label:a.elements[n].name,value:a.elements[n].value});return u.isItemsLoading[e+"ItemsLoading_"+t]=!1,u.itemsReturn[e+"_"+t],u.itemsReturn[e+"_"+t]});return d},u.itemsOnceSelected={},u.recordItem=function(e,t){u.itemsOnceSelected[e.label]=e.value},u.currentSearchId="",u.isSingleShow=function(){for(var e=0,t=0;t<d.length;t++)u[d[t]+"Selected_0"]&&""!=u[d[t]+"Selected_0"]&&(u.currentSearchId=u.itemsOnceSelected[u[d[t]+"Selected_0"]],e++,u[d[t]+"Selected_1"]&&""!=u[d[t]+"Selected_0"]&&e++);return e>1?0:1},u.submitQuery=function(t){var a=u.currentSearchId;return a?(void 0,store.set("currentId",a),void e.$emit("submitQuery",a)):(void 0,0)},u.historyMem=[],e.$on("historyUpdate",function(e,t){void 0,u.getHistoryMem(),void 0}),u.getHistoryMem=function(){store.has("hID")||store.set("hID",0);var e=store.get("hID");u.historyMem=[];for(var t=0;t<10;t++)store.get("historyItem"+(e+t)%10)&&store.has("historyItem"+(e+t)%10)&&u.historyMem.push(store.get("historyItem"+(e+t)%10))},u.getHistoryMem(),u.queryAgain=function(t){e.$emit("submitQuery",t)},u.disConditions=[{num:0}],u.symConditions=[{num:0}],u.medConditions=[{num:0}],u.labConditions=[{num:0}],u.addCondition=function(e,t){s.errorModal.unneededAPI.apiTimestamp=0,u[t+"Option_"+(e+1)]={label:"AND"},e<10&&u[t+"Conditions"].push({num:e+1})},u.removeCondition=function(e,t){var a=u[t+"Conditions"];if(a.splice(e,1),e===a.length)u[t+"Class_"+e]&&(u[t+"Class_"+e]={}),u[t+"Fclass_"+e]&&(u[t+"Fclass_"+e]={}),u[t+"Sclass_"+e]&&(u[t+"Sclass_"+e]={}),u[t+"Fbody_"+e]&&(u[t+"Fbody_"+e]={}),u[t+"Sbody_"+e]&&(u[t+"Sbody_"+e]={}),u[t+"Selected_"+e]="";else for(var n=e;n<a.length;n++)a[n].num--,n<a.length&&(u[t+"Class_"+n]&&(u[t+"Class_"+n]=u[t+"Class_"+(n+1)],n===a.length-1&&(u[t+"Class_"+(n+1)]={})),u[t+"Fclass_"+n]&&(u[t+"Fclass_"+n]=u[t+"Fclass_"+(n+1)],n===a.length-1&&(u[t+"Fclass_"+(n+1)]={})),u[t+"Sclass_"+n]&&(u[t+"Sclass_"+n]=u[t+"Sclass_"+(n+1)],n===a.length-1&&(u[t+"Sclass_"+(n+1)]={})),u[t+"Fbody_"+n]&&(u[t+"Fbody_"+n]=u[t+"Fbody_"+(n+1)],n===a.length-1&&(u[t+"Fbody_"+(n+1)]={})),u[t+"Sbody_"+n]&&(u[t+"Sbody_"+n]=u[t+"Sbody_"+(n+1)],u[t+"Sbody_"+(n+1)]={}),u[t+"Selected_"+n]=u[t+"Selected_"+(n+1)],u[t+"Selected_"+(n+1)]="")},u.isPlusShow=function(e,t){return e<u[t+"Conditions"].length-1?0:1},u.isMinusShow=function(e,t){return 0===e&&1===u[t+"Conditions"].length?0:1};var p=function(){for(var e={AND:[],NOT:[]},t=0;t<4;t++)for(var a=u[d[t]+"Conditions"].length,n=0;n<a;n++)u.itemsOnceSelected[u[d[t]+"Selected_"+n]]&&e[u[d[t]+"Option_"+n].label].push(u.itemsOnceSelected[u[d[t]+"Selected_"+n]]);return 0==e.NOT.length&&e.NOT.push(""),0==e.AND.length&&e.AND.push(""),e};u.searchDisease=function(){s.errorModal.unneededAPI.apiTimestamp=0,r.getDiseaseIds(p()).then(function(t){var a={DIDS:t.elements};e.$emit("getDiseaseIds",a)})},u.searchMedicine=function(){s.errorModal.unneededAPI.apiTimestamp=0,r.getMedicineIds(p()).then(function(t){var a={MIDS:t.elements};e.$emit("getMedicineIds",a)})}}function PatientClinicalPathwayController(e,t,a,n,l){e.isMax=!1,a.pItemSelected&&(e.pItemSelected=a.pItemSelected),e.pIds=[945209345,390870343,792838150,843209388,200483967,379404302,391970840,936108059,918102054,268058664,885653512,786333707,189759502,539164696,280543278],e.getPid=function(a){var n=e.dTypes.indexOf(a),l=t.getPid(n).then(function(e){return e.Results});return l},e.drawTimeline=function(e){a.pItemSelected=e;var n={scale:"human",title:{media:{caption:"",credit:"",url:"assets/img/timeline/placeholder.jpg",thumb:""},text:{headline:"个人信息展示",text:"<p></p>"}},events:[]};$("#timeline").html(""),t.getPatientByID(e).then(function(e){void 0;var t=e.DIAGNOSIS.Records.concat(e.LAB.Records.concat(e.MEDICATION.Records.concat(e.PROCEDURE.Records)));t.sort(function(e,t){var a=Date.parse(new Date(e.DD)),n=Date.parse(new Date(t.DD));return a===n?e.FTYPE===t.FTYPE?e.NAMECN.localeCompare(t.NAMECN):e.FTYPE.localeCompare(t.FTYPE):Date.parse(new Date(e.DD))-Date.parse(new Date(t.DD))});var a={LAB:{Records:e.LAB.Records}};a.LAB.Records.sort(function(e,t){var a=Date.parse(new Date(e.DD)),n=Date.parse(new Date(t.DD));return a===n?e.FTYPE===t.FTYPE?e.NAMECN.localeCompare(t.NAMECN):e.FTYPE.localeCompare(t.FTYPE):Date.parse(new Date(e.DD))-Date.parse(new Date(t.DD))}),void 0;for(var l=0,o={DIAGNOSIS:"Symptom.png",LAB:"Lab.png",MEDICATION:"Medication.png",PROCEDURE:"Clinicalpath.png"},s={DIAGNOSIS:"#FF9966",LAB:"#ACE1AF",MEDICATION:"#B9DCED",PROCEDURE:"#cc99cc"};l<t.length;){var i={start_date:{},media:{caption:"",credit:"",url:"assets/img/timeline/placeholder.jpg",thumb:""},text:{}},c=t[l].DD.split("-");i.start_date={year:c[0],month:c[1],day:c[2]};for(var d='<div class="tl-nodesType-'+t[l].FTYPE.toLowerCase()+'"><img src="assets/img/timeline/'+o[t[l].FTYPE]+'" style="width:10px; height:10px;background-color:'+s[t[l].FTYPE]+'">'+t[l].NAMECN,u=1;l<t.length-1&&t[l].NAMECN===t[l+1].NAMECN&&t[l].DD===t[l+1].DD;)l++,u++;u>1&&(d+="*"+u),d+="</div>",i.text.headline=d,void 0,void 0,n.events.push(i),l++}void 0;var g={language:"zh-cn"};void 0;new TL.Timeline("timeline",n,g);void 0;for(var p=["diagnosis","lab","medication","procedure"],l=0;l<p.length;l++){$(".tl-nodesType-"+p[l]);$(".tl-nodesType-"+p[l]).parents(".tl-timemarker-content-container").css({"background-color":s[p[l].toUpperCase()]}),$(".tl-nodesType-procedure").parents(".tl-timemarker-content-container").prev(".tl-timemarker-timespan").children(".tl-timemarker-line-left").addClass("PROCEDURE"),$(".tl-nodesType-medication").parents(".tl-timemarker-content-container").prev(".tl-timemarker-timespan").children(".tl-timemarker-line-left").addClass("MEDICATION"),$(".tl-nodesType-lab").parents(".tl-timemarker-content-container").prev(".tl-timemarker-timespan").children(".tl-timemarker-line-left").addClass("LAB"),$(".tl-nodesType-diagnosis").parents(".tl-timemarker-content-container").prev(".tl-timemarker-timespan").children(".tl-timemarker-line-left").addClass("DIAGNOSIS")}$(".tl-slidenav-content-container").click(function(){void 0,setTimeout("$('.tl-timemarker-active').trigger('click',console.log('trigger click'))",100)});for(var l=0;l<p.length;l++){$(".tl-nodesType-"+p[l]);$(".tl-nodesType-"+p[l]).parents(".tl-timemarker-content-container").css({"background-color":s[p[l].toUpperCase()]})}$(".tl-nodesType-lab").parents(".tl-timemarker").click(function(){void 0,void 0,void 0;var e=$(this).attr("id"),t=e.substring(0,e.length-7);void 0,void 0,void 0;var n,l,o=$("#"+t).find(".tl-headline-date").html(),s=o.indexOf("月"),i=o.indexOf("日");n=s-6>0?o.substring(5,s):"0"+o.substring(5,s),l=i-s-3>0?o.substring(s+2,i):"0"+o.substring(s+2,i);var c=o.substring(0,4)+"-"+n+"-"+l;void 0,void 0,void 0,void 0,r(t,a,c)})})};var o=function(e){e=e||window.event;var t=($(".tl-timenav"),function(e){e>0?$(".tl-icon-zoom-in").trigger("click"):$(".tl-icon-zoom-out").trigger("click")});e.wheelDelta?t(e.wheelDelta):e.detail&&t(e.detail)};$(".tl-icon-zoom-in").context.onmousewheel=o;var r=function(e,t,a){function n(){function n(e,t,a){setdata(e,t,a),initializeUser(e,t,a)}void 0,r++,void 0;var s=$("#"+e+" .tl-media-content img");if(0==s.length&&r<20)return void void 0;void 0,clearInterval(l),$("#hgraph").remove();var i;i=r>19?$("#"+e+" .tl-media-content"):s.parent(),i.html('<div id="hgraph" class="tl-media-item tl-media-image tl-media-shadow" src="graph" style="max-height: 448px;"><div id="map" style="height: 340px;min-height: 300px;  min-width: 360px;"></div></div>'),void 0;n(t,a,"map"),void 0,o++}void 0,void 0;var l=setInterval(n,100),o=0,r=0;n()};void 0,a.pageLoading=!1}function SimilarPatientsDiaStatisticsController(e,t,a,n,l){function o(t,a,l){function o(t,l){function o(e){e.x=e.y=0,e.dx=S,e.dy=k,e.depth=0}function s(e){return(e._children=e.values)?e.value=e.values.reduce(function(e,t){return e+s(t)},0):e.value}function i(e){e._children&&(I.nodes({_children:e._children}),e._children.forEach(function(t){t.x=e.x+t.x*e.dx,t.y=e.y+t.y*e.dy,t.dx*=e.dx,t.dy*=e.dy,t.parent=e,i(t)}))}function c(t,a){function l(e,t){if(!C&&e){C=!0;var a=c(e,1),n=o.transition().duration(750),l=a.transition().duration(750);w.domain([e.x,e.x+e.dx]),D.domain([e.y,e.y+e.dy]),P.style("shape-rendering",null),P.selectAll(".depth").sort(function(e,t){return e.depth-t.depth}),a.selectAll("text").style("fill-opacity",0),n.selectAll(".ptext").call(d).style("fill-opacity",0),n.selectAll(".ctext").call(u).style("fill-opacity",0),l.selectAll(".ptext").call(d).style("fill-opacity",1),l.selectAll(".ctext").call(u).style("fill-opacity",1),n.selectAll("rect").call(g),l.selectAll("rect").call(g),n.remove().each("end",function(){P.style("shape-rendering","crispEdges"),C=!1})}}n.isSPDiagnosisGraphLoading=!1,e.isGraphLoading=!1,N.datum(t.parent).on("click",l).select("text").text(p(t));var o=P.insert("g",".grandparent").datum(t).attr("class","depth"),r=o.selectAll("g").data(t._children).enter().append("g");1===a&&r.classed("treemap-normal",!0),r.filter(function(e){return e._children}).classed("children",!0).classed("treemap-normal",!0).on("click",l);var s=r.selectAll(".child").data(function(e){return e._children||[e]}).enter().append("g");s.classed("treemap-normal",!0);s.append("rect").attr("class","child").call(g).append("title").text(function(e){return e.key+" ("+f(e.value)+")"}),s.append("text").attr("class","ctext").text(function(e){return e.key}).call(u),r.append("rect").attr("class","parent").call(g).on("click",function(e){});var i=r.append("text").attr("class","ptext").attr("dy",".75em");return i.append("tspan").text(function(e){return e.key}),i.append("tspan").attr("dy","1.0em").text(function(e){return f(e.value)}),i.call(d),r.selectAll("rect").style("fill",function(e){return x(e.key)}),r}function d(e){e.selectAll("tspan").attr("x",function(e){return w(e.x)+6}),e.attr("x",function(e){return w(e.x)+6}).attr("y",function(e){return D(e.y)+6}).style("opacity",function(e){return this.getComputedTextLength()<w(e.x+e.dx)-w(e.x)?1:0})}function u(e){e.attr("x",function(e){return w(e.x+e.dx)-this.getComputedTextLength()-6}).attr("y",function(e){return D(e.y+e.dy)-6}).style("opacity",function(e){return this.getComputedTextLength()<w(e.x+e.dx)-w(e.x)?1:0})}function g(e){e.attr("x",function(e){return w(e.x)}).attr("y",function(e){return D(e.y)}).attr("width",function(e){return w(e.x+e.dx)-w(e.x)}).attr("height",function(e){return D(e.y+e.dy)-D(e.y)})}function p(e){return e.parent?p(e.parent)+" / "+e.key+" ("+f(e.value)+")":e.key+" ("+f(e.value)+")"}var m,h=$.extend(!0,{},r,t),f=d3.format(h.format),v=h.rootname,b=h.margin,y=0;$("#"+a).width(h.width).height(h.height);var C,S=h.width-b.left-b.right,k=h.height-b.top-b.bottom-y,x=d3.scale.category20c(),w=d3.scale.linear().domain([0,S]).range([0,S]),D=d3.scale.linear().domain([0,k]).range([0,k]),I=d3.layout.treemap().children(function(e,t){return t?null:e._children}).sort(function(e,t){return e.value-t.value}).ratio(k/S*.5*(1+Math.sqrt(5))).round(!1),P=d3.select("#"+a).append("svg").attr("width",S+b.left+b.right).attr("height",k+b.bottom+b.top).style("margin-left",-b.left+"px").style("margin.right",-b.right+"px").append("g").attr("transform","translate("+b.left+","+b.top+")").style("shape-rendering","crispEdges"),N=P.append("g").attr("class","grandparent");if(N.append("rect").attr("y",-b.top).attr("width",S).attr("height",b.top),N.append("text").attr("x",6).attr("y",6-b.top).attr("dy",".75em"),h.title&&$("#chart").prepend("<p class='title'>"+h.title+"</p>"),m=l instanceof Array?{key:v,values:l}:l,o(m),s(m),i(m),c(m),window.parent!==window){var R=document.documentElement.scrollHeight||document.body.scrollHeight;window.parent.postMessage({height:R},"*")}}e.treemapState=1,d3.select("#"+a+" svg").remove();var r={margin:{top:24,right:20,bottom:0,left:0},rootname:"TOP",format:",d",title:"",width:$(".widget-body").width(),height:600};e.$apply(),e.isMax===!0&&(r.height=$(".widget-body").height()-10);var s=d3.nest().key(function(e){return e.subregion}).entries(t);e.isGraphLoading=!1,n.isSPDiagnosisGraphLoading=!1,o({title:"诊断"},{key:"诊断",values:s})}e.isMax=!1,n.pItemSelected&&(e.pItemSelected=n.pItemSelected),e.$on("STARTRENDER",function(e,t){var n=a.getData();o(n.treemapRec,"treemap",n.records)}),n.pageLoading=!1}function SimilarPatientsMedStatisticsController(e,t,a,n,l){function o(t,a,n){function l(t,n){function l(e){e.x=e.y=0,e.dx=C,e.dy=S,e.depth=0}function r(e){return(e._children=e.values)?e.value=e.values.reduce(function(e,t){return e+r(t)},0):e.value}function s(e){e._children&&(D.nodes({_children:e._children}),e._children.forEach(function(t){t.x=e.x+t.x*e.dx,t.y=e.y+t.y*e.dy,t.dx*=e.dx,t.dy*=e.dy,t.parent=e,s(t)}))}function i(t,a){function n(e,t){if(!y&&e){y=!0;var a=i(e,1),n=l.transition().duration(750),o=a.transition().duration(750);x.domain([e.x,e.x+e.dx]),w.domain([e.y,e.y+e.dy]),I.style("shape-rendering",null),I.selectAll(".depth").sort(function(e,t){return e.depth-t.depth}),a.selectAll("text").style("fill-opacity",0),n.selectAll(".ptext").call(c).style("fill-opacity",0),n.selectAll(".ctext").call(d).style("fill-opacity",0),o.selectAll(".ptext").call(c).style("fill-opacity",1),o.selectAll(".ctext").call(d).style("fill-opacity",1),n.selectAll("rect").call(u),o.selectAll("rect").call(u),n.remove().each("end",function(){I.style("shape-rendering","crispEdges"),y=!1})}}e.isGraphLoading=!1,P.datum(t.parent).on("click",n).select("text").text(g(t));var l=I.insert("g",".grandparent").datum(t).attr("class","depth"),o=l.selectAll("g").data(t._children).enter().append("g");1===a&&o.classed("treemap-normal",!0),o.filter(function(e){return e._children}).classed("children",!0).classed("treemap-normal",!0).on("click",n);var r=o.selectAll(".child").data(function(e){return e._children||[e]}).enter().append("g");r.classed("treemap-normal",!0);r.append("rect").attr("class","child").call(u).append("title").text(function(e){return e.key+" ("+h(e.value)+")"}),r.append("text").attr("class","ctext").text(function(e){return e.key}).call(d),o.append("rect").attr("class","parent").call(u);var s=o.append("text").attr("class","ptext").attr("dy",".75em");return s.append("tspan").text(function(e){return e.key}),s.append("tspan").attr("dy","1.0em").text(function(e){return h(e.value)}),s.call(c),o.selectAll("rect").style("fill",function(e){return k(e.key)}),o}function c(e){e.selectAll("tspan").attr("x",function(e){return x(e.x)+6}),e.attr("x",function(e){return x(e.x)+6}).attr("y",function(e){return w(e.y)+6}).style("opacity",function(e){return this.getComputedTextLength()<x(e.x+e.dx)-x(e.x)?1:0})}function d(e){e.attr("x",function(e){return x(e.x+e.dx)-this.getComputedTextLength()-6}).attr("y",function(e){return w(e.y+e.dy)-6}).style("opacity",function(e){return this.getComputedTextLength()<x(e.x+e.dx)-x(e.x)?1:0})}function u(e){e.attr("x",function(e){return x(e.x)}).attr("y",function(e){return w(e.y)}).attr("width",function(e){return x(e.x+e.dx)-x(e.x)}).attr("height",function(e){return w(e.y+e.dy)-w(e.y)})}function g(e){return e.parent?g(e.parent)+" / "+e.key+" ("+h(e.value)+")":e.key+" ("+h(e.value)+")"}var p,m=$.extend(!0,{},o,t),h=d3.format(m.format),f=m.rootname,v=m.margin,b=0;$("#"+a).width(m.width).height(m.height);var y,C=m.width-v.left-v.right,S=m.height-v.top-v.bottom-b,k=d3.scale.category20c(),x=d3.scale.linear().domain([0,C]).range([0,C]),w=d3.scale.linear().domain([0,S]).range([0,S]),D=d3.layout.treemap().children(function(e,t){return t?null:e._children}).sort(function(e,t){return e.value-t.value}).ratio(S/C*.5*(1+Math.sqrt(5))).round(!1),I=d3.select("#"+a).append("svg").attr("width",C+v.left+v.right).attr("height",S+v.bottom+v.top).style("margin-left",-v.left+"px").style("margin.right",-v.right+"px").append("g").attr("transform","translate("+v.left+","+v.top+")").style("shape-rendering","crispEdges"),P=I.append("g").attr("class","grandparent");if(P.append("rect").attr("y",-v.top).attr("width",C).attr("height",v.top),P.append("text").attr("x",6).attr("y",6-v.top).attr("dy",".75em"),m.title&&$("#chart").prepend("<p class='title'>"+m.title+"</p>"),p=n instanceof Array?{key:f,values:n}:n,l(p),r(p),s(p),i(p),window.parent!==window){var N=document.documentElement.scrollHeight||document.body.scrollHeight;window.parent.postMessage({height:N},"*")}}e.treemapState=1,d3.select("#"+a+" svg").remove();var o={margin:{top:24,right:20,bottom:0,left:0},rootname:"TOP",format:",d",title:"",width:$(".widget-body").width(),height:600};e.$apply(),void 0,e.isMax===!0&&(o.height=$(".widget-body").height()-10);var r=d3.nest().entries(t);e.isGraphLoading=!1,l({title:"用药"},{key:"用药",values:r})}e.isMax=!1,a.pItemSelected&&(e.pItemSelected=a.pItemSelected),e.$on("STARTRENDER",function(t,a){for(var l=n.getData(),r=[],s=l.sankeyData,i=l.sankeyData.NumCohort||1,c=0;c<i;c++)for(var d=s[c].Similarities,u=d.length,g=0;g<u;g++)for(var p=d[g].Sequences,m=p.length,h=0;h<m;h++)r.push(p[h].NAMECN);r.sort();var f=[],c=0,v=r.length;do{var b={},y=1;for(b.key=r[c];r[c]===r[c+1];)y++,c++;b.value=y,f.push(b),c++}while(c<v-2);o(f,"treemap"),e.isGraphLoading=!1}),a.pageLoading=!1}function SPDiagnosisCtrl(e,t,a,n){function l(e){for(var t=[],a=(new Date).getFullYear(),n=0;n<e.length;n++)for(var l=e[n].Similarities,o=0;o<l.length;o++)for(var r=a-l[o].YOB+1,s=l[o].Gender,i=l[o].PID,c=l[o].Sequences,d=0;d<c.length;d++){var u={PID:i,age:r,gender:s,namecn:c[d].NAMECN,hierarchy:c[d].HIERARCHY,ftype:c[d].FTYPE};t.push(u)}return t}e.isMax=!1,e.pIds=[945209345,390870343,792838150,843209388,200483967,379404302,391970840,936108059,918102054,268058664,885653512,786333707,189759502,539164696,280543278];var o=function(){e.$broadcast("STARTRENDER",{}),void 0};e.recordItem=function(e){t.pItemSelected=e},e.search=function(r,s){s&&"toggleMax"===s&&(e.isMax=!e.isMax),t.pItemSelected=r,d3.select("#treemap svg").remove(),$("#treemapLoading").css("margin-left",$(".widget-body").width()/2-30),d3.select("#chart_sankeys svg").remove(),$("#chart_sankeysLoading").css("margin-left",$("#chart_sankeys").width()/2-30),e.isGraphLoading_dia=!0,t.isSPDiagnosisGraphLoading=!0,e.isGraphLoading=!0,a.getSankeyData(r).then(function(a){if(0==a.Return)return $("#chart_sankeys svg g").html("暂无数据！！！"),void $("#treemap").html("暂无数据");e.dTypes=a.Data;var r=a.Data,i=r.length;if(s&&"toggleMax"!==s){void 0;for(var c=0;c<i;c++)if(r[c].CohortName===s){r=r.slice(c,c+1),e.typeSelection=e.dTypes[c];break}}s||(r=r.slice(0,1),e.typeSelection=e.dTypes[0]);var d={};d.data=l(r);var u=crossfilter(d.data);d.dim={gender:u.dimension(function(e){return e.gender}),age:u.dimension(function(e){return e.age}),namecn:u.dimension(function(e){return e.namecn}),PID:u.dimension(function(e){return e.PID}),hierarchy:u.dimension(function(e){return e.hierarchy}),ftype:u.dimension(function(e){return e.ftype})};for(var g=d.dim.namecn.group().reduce(function(e,t){return"object"!=typeof e&&(e={}),e.ftype=t.ftype,e.hierarchy=t.hierarchy,e.value=(e.value||0)+1,e},function(e,t){},function(){return 0}),p=g.all(),m=[],h=[],f=[],v={},c=0;c<p.length;c++)if(p[c].value){if(h.indexOf(p[c].value.ftype)===-1&&(p[c].value.hierarchy?v[p[c].value.ftype]={}:v[p[c].value.ftype]=[],h.push(p[c].value.ftype)),f.indexOf(p[c].value.hierarchy)===-1){if(!p[c].value.hierarchy){var b=v[p[c].value.ftype];b.indexOf(p[c].key)===-1&&b.push(p[c].key);continue}v[p[c].value.ftype][p[c].value.hierarchy]=[],f.push(p[c].value.hierarchy)}var b=v[p[c].value.ftype][p[c].value.hierarchy];if(b.indexOf(p[c].key)===-1&&b.push(p[c].key),"DIAGNOSIS"===p[c].value.ftype){var y={value:p[c].value.value};p[c].value.hierarchy?(y.subregion=p[c].value.hierarchy,y.key=p[c].key):(y.region=p[c].value.ftype,y.subregion=p[c].value.ftype,y.key=p[c].key)}m.push(y)}for(var C={ChronicObstructivePulmonaryDis:"慢性阻塞性肺病",Heart_failure:"心力衰竭",Obesity:"肥胖症",PulmonaryDis:"肺病",KidneyDis:"肾病",Diabetes:"糖尿病"},S={model:"1",lists:[]},c=0;c<r.length;c++){var k={};k.id=r[c].CohortIdx,k.name=C[r[c].CohortName],S.lists.push(k);for(var x=r[c].Similarities,w=0;w<x.length;w++){var D=x[w].Sequences;x[w].Sequences=d3.nest().key(function(e){return e.DD}).sortKeys(d3.ascending).entries(D)}}e.$broadcast("getHierarchyJson",v),t.isSPDiagnosisGraphLoading=!1,e.isGraphLoading=!1,n.addData("records",d),n.addData("treemapRec",m),n.addData("hierarchyJson",v),n.addData("sankeyData",r),n.addData("cohortslist",S),o()})},t.pageLoading=!1}function SPMedicationCtrl(e,t,a,n){function l(e){for(var t=[],a=(new Date).getFullYear(),n=0;n<e.length;n++)for(var l=e[n].Similarities,o=0;o<l.length;o++)for(var r=a-l[o].YOB+1,s=l[o].Gender,i=l[o].PID,c=l[o].Sequences,d=0;d<c.length;d++){var u={PID:i,age:r,gender:s,namecn:c[d].NAMECN,hierarchy:c[d].HIERARCHY,ftype:c[d].FTYPE};t.push(u)}return t}e.isMax=!1,e.pIds=[945209345,390870343,792838150,843209388,200483967,379404302,391970840,936108059,918102054,268058664,885653512,786333707,189759502,539164696,280543278];var o=function(){e.$broadcast("STARTRENDER",{}),void 0};e.search=function(r,s){s&&"toggleMax"===s&&(e.isMax=!e.isMax),t.pItemSelected=r,d3.select("#treemap svg").remove(),$("#treemapLoading").css("margin-left",$(".widget-body").width()/2-30),t.isSPDiagnosisGraphLoading=!0,e.isGraphLoading=!0,a.getSankeyMedData(r).then(function(a){if(1==a.Return)return $("#chart_sankeys svg g").html("暂无数据！！！"),void $("#treemap").html("暂无数据");e.dTypes=a.Data;var r=a.Data,i=r.length;a.Data;if(s&&"toggleMax"!==s)for(var c=0;c<i;c++)if(r[c].CohortName===s){r=r.slice(c,c+1),e.typeSelection=e.dTypes[c];break}s||(r=r.slice(0,1),e.typeSelection=e.dTypes[0]);var d={};d.data=l(a.Data);var u=crossfilter(d.data);d.dim={gender:u.dimension(function(e){return e.gender}),age:u.dimension(function(e){return e.age}),namecn:u.dimension(function(e){return e.namecn}),PID:u.dimension(function(e){return e.PID}),hierarchy:u.dimension(function(e){return e.hierarchy}),ftype:u.dimension(function(e){return e.ftype})};for(var g=d.dim.namecn.group().reduce(function(e,t){return"object"!=typeof e&&(e={}),e.ftype=t.ftype,e.hierarchy=t.hierarchy,e.value=(e.value||0)+1,e},function(e,t){},function(){return 0}),p=g.all(),m=[],h=[],f=[],v={},c=0;c<p.length;c++)if(p[c].value){if(h.indexOf(p[c].value.ftype)===-1&&(p[c].value.hierarchy?v[p[c].value.ftype]={}:v[p[c].value.ftype]=[],h.push(p[c].value.ftype)),f.indexOf(p[c].value.hierarchy)===-1){if(!p[c].value.hierarchy){var b=v[p[c].value.ftype];b.indexOf(p[c].key)===-1&&b.push(p[c].key);continue}v[p[c].value.ftype][p[c].value.hierarchy]=[],f.push(p[c].value.hierarchy)}var b=v[p[c].value.ftype][p[c].value.hierarchy];if(b.indexOf(p[c].key)===-1&&b.push(p[c].key),"DIAGNOSIS"===p[c].value.ftype){var y={value:p[c].value.value};p[c].value.hierarchy?(y.subregion=p[c].value.hierarchy,y.key=p[c].key):(y.region=p[c].value.ftype,y.subregion=p[c].value.ftype,y.key=p[c].key)}m.push(y)}t.isSPDiagnosisGraphLoading=!1,e.isGraphLoading=!1,n.addData("sankeyData",r),n.addData("records",d),n.addData("treemapRec",m),n.addData("hierarchyJson",v),o()})},t.pageLoading=!1}function AdvReaction1(e,t,a,n){var l=e.vm={};t.pageLoading=!1,l.Ids=["d100001","d100002","d100003","d100004","d100007","d100008","d100009","d100010","d100011","d100012","d100101","d111000","d110000","d111100","d120000","d123000","d137080","m100001","m100007","m100008","m100015","m100017","m100018","m100020","m100080","m100100"],
l.test=function(){void 0},l.ShowGraph=function(){d3.select("svg").remove();var e=708,t=600;if(l.selected){d3.select(".widget-body").select(".row").select(".col-md-12").append("div").attr("id","AdvGraph").attr("class","col-md-12").attr("style","background-color:#F0F8FF");var a=d3.select("#AdvGraph").append("svg").attr("background","steelblue").attr("width",e).attr("height",t)}var n=a.append("g").attr("transform","translate("+.15*e+",0)"),o=.5*e;d3.json('http://59.110.52.133:3010/api/transfer/?q={"path":"/adr/getMapTree","params":%7B%22Id%22:%22'+l.selected+"%22%7D}").get(function(l,r){if(l)throw l;void 0;var s=r.Results;void 0;for(var i=0;i<s.length;i++)if(""===s[i].parent){var c=s[i].name;s[i].name=s[i].name+s[i].category;for(var d=0;d<s.length;d++)s[d].parent===c&&""!==s[d].category&&(s[d].parent=s[d].parent+s[i].category)}var u=[{category:"D"},{category:"M"},{category:"A"}],g=d3.layout.cluster().size([t,.6*e]),p=function(e){for(var t={},a=0;a<e.length;a++)if(""===e[a].parent&&"M"===e[a].category){e[a].children=[];for(var n=0;n<e.length;n++)"M"!==e[n].category&&e[a].children.push(e[n]);t=e[a]}else if(""===e[a].parent&&"D"===e[a].category){e[a].children=[];for(var n=0;n<e.length;n++)e[n].parent===e[a].name&&e[a].children.push(e[n]);void 0;for(var l=0;l<e[a].children.length;l++)if("M"===e[a].children[l].category){e[a].children[l].children=[];for(var o=0;o<e.length;o++)e[o].parent===e[a].children[l].name&&e[a].children[l].children.push(e[o])}t=e[a]}return t},m=d3.svg.diagonal().projection(function(e){return[e.y,e.x]}),h=p(s);void 0;for(var f=g.nodes(h),v=g.links(f),i=0;i<f.length;i++)if(""===f[i].parent&&"M"===f[i].category){var b=t/(f[i].children.length+1),y=[],C=[];f[i].y=.5*o;for(var d=0;d<f[i].children.length;d++)"D"===f[i].children[d].category?(y.push(f[i].children[d]),f[i].children[d].y=0):C.push(f[i].children[d]);for(var S=0,k=0,x=0,w=0,$=0;$<f[i].children.length;$++)"D"===f[i].children[$].category?(f[i].children[$].x=f[i].x+S*b,k=k%2===0?1-k:-(k+1),S+=k):(f[i].children[$].x=f[i].x+x*b,w=w%2===0?1-w:-(w+1),x+=w)}void 0;var D=a.selectAll(".AdvLegend").data(u).enter().append("g").attr("class","AdvLegend").attr("transform",function(e,t){var a=50,n=20*t+50;return"translate("+a+","+n+")"});D.append("circle").attr("r",4).attr("fill",function(e){return"D"===e.category?"#000079":"M"===e.category?"#272727":"A"===e.category?"#930000":"#BEBEBE"}),D.append("text").attr("dx",10).attr("dy",4).text(function(e){return"D"===e.category?"药品":"M"===e.category?"药物":"A"===e.category?"不良反应":void 0});var I=(n.selectAll(".link").data(v).enter().append("path").attr("class","Advlink").attr("d",m),n.selectAll(".node").data(f).enter().append("g").attr("class",function(e){return"Advnode"+(e.children?" Advnode--internal":" Advnode--leaf")}).attr("transform",function(e){return"translate("+e.y+","+e.x+")"}));I.append("circle").attr("class","AdvNodeCircle").attr("r",function(e){return""===e.parent?4:2.5}).attr("fill",function(e){return"D"===e.category?"#000079":"M"===e.category?"#272727":"A"===e.category?"#930000":"#BEBEBE"}),I.append("text").attr("dy",3).attr("x",function(e){return e.children?-8:8}).style("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.name})})}}function AdvReaction2(e,t,a,n){var l=e.vm={};a.pageLoading=!1,l.IdForSelect=["1","2","3","4","5","6"],l.Select=function(){l.PatientId=[],l.items=[],l.Info=[],l.DisplayedItems=[],l.WaitingForDelete=[],null!=l.value?t.get('http://59.110.52.133:3010/api/transfer/?q={"path":"/adr/getDrug","params":{%22Disease%22:%22%E6%84%9F%E5%86%92%22,%22Pid%22:'+l.value+"}}").success(function(e){void 0,l.patient=e.Results,void 0,l.columns=[{label:"药品名",name:"name",type:"string"},{label:"生产厂商",name:"manufacturer",type:"string"},{label:"适应症",name:"indication",type:"string"},{label:"详情",name:"actions",sortable:!1}],l.Display=function(){return null!=l.value},l.Change=function(){void 0,l.DisplayedItems=[],l.WaitingForDelete=[],l.items=l.patient.Drugs,l.Info=l.patient.PatientInfo},l.Change();for(var t=0;t<l.items.length;t++)l.items[t].Selectable===-1?l.items[t].color="#FFB5B5":0===l.items[t].Selectable?l.items[t].color="#BEBEBE":l.items[t].color="#ffffff";for(var t=0;t<l.items.length;t++)1===l.items[t].Selectable?l.items[t].model=null:l.items[t].model=l.items[t].Xid;void 0,l.checkAll=function(e){angular.forEach(l.items,function(t){t.$checked=e})},l.SafecheckAll=function(e){angular.forEach(l.items,function(t){t.$Safechecked=e})},l.selection=function(){return _.where(l.items,{$checked:!0})},l.Indstring=function(e){return e.length>36?e.slice(0,35)+"...":e},l.Manustring=function(e){return null===e?"Miss Manufaturer":e.length>10?e.slice(0,9):e},l.getIndex=function(e){l.WaitingForDelete=[],l.WaitingForDelete.push(e)},l.Fixed=function(e,t){for(var a=0;a<e.length;a++){var n={};if(n.Xid=e[a].Xid,n.Name=e[a].Name,1===e[a].Selectable?(n.Selectable="安全药品，推荐",n.color="#003D79"):0===e[a].Selectable?(n.Selectable="不确定安全性",n.color="#5B5B5B"):(n.Selectable="不安全,不推荐",n.color="#AE0000"),n.Reason=e[a].Reason,n.Num=1,e[a].Reason===[]?n.Reason="无":n.Reason=e[a].Reason,0===t.length)t.push(n);else{for(var l=0;l<t.length;l++)if(t[l].Xid===n.Xid){t[l].Num++;break}l===t.length&&t.push(n)}void 0}},l.AddLine=function(e){l.Line=[],l.Line.push(e),l.Fixed(l.Line,l.DisplayedItems)},l.AddAdjust=function(e){l.Line=[],l.Line.push(e),null==e.model&&l.Fixed(l.Line,l.DisplayedItems)},l.removeFromList=function(e){l.DisplayedItems=_.reject(l.DisplayedItems,function(t){return e.Xid===t.Xid})},l.WishSub=function(){l.SafeItems=_.filter(l.items,function(e){return 1===e.Selectable})},l.Switch=function(){l.SubItems=_.where(l.SafeItems,{$Safechecked:!0}),l.SubItems!==[]&&(angular.forEach(l.SafeItems,function(e){e.$Safechecked=!1}),l.Fixed(l.SubItems,l.DisplayedItems),l.removeFromList(l.WaitingForDelete[0]))},l.decrementQuantity=function(e){e.Num--,0===e.Num&&l.removeFromList(e)},l.incrementQuantity=function(e){e.Num++},l.page={size:5,index:1},l.sort={column:"id",direction:-1,toggle:function(e){e.sortable!==!1&&(this.column===e.name?this.direction=-this.direction||-1:(this.column=e.name,this.direction=-1))}}}):(l.filter.$=null,l.items=[],l.Info=[],l.DisplayedItems=[],l.WaitingForDelete=[])}}function searchStartController(e){void 0,e.pageLoading=!1}DiseaseCauseStatisticsController.$inject=["$scope","Data","$rootScope","$location","$http"],GraphQueryController.$inject=["$scope","diagnosisClassData","bodyData","diseaseClassData","labClassData","medicineClassData","Data","$rootScope"],PatientClinicalPathwayController.$inject=["$scope","Data","$rootScope","$http","$location"],SimilarPatientsDiaStatisticsController.$inject=["$scope","Data","SPDiagnosisSharedDataService","$rootScope","$location"],SimilarPatientsMedStatisticsController.$inject=["$scope","Data","$rootScope","SPMedicationSharedDataService","$location"],SPDiagnosisCtrl.$inject=["$scope","$rootScope","Data","SPDiagnosisSharedDataService"],SPMedicationCtrl.$inject=["$scope","$rootScope","Data","SPMedicationSharedDataService"],AdvReaction1.$inject=["$scope","$rootScope","$http","$location"],AdvReaction2.$inject=["$scope","$http","$rootScope","$location"],searchStartController.$inject=["$rootScope"],angular.module("app",["duScroll","ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngStorage","ui.router","ncy-angular-breadcrumb","ui.bootstrap","ui.utils","oc.lazyLoad","integralui","ngGrid"]),angular.module("app").controller("AppCtrl",["$rootScope","$localStorage","$state","$timeout",function(e,t,a,n){e.pageLoading=!0,void 0,void 0;var l={"/app/mkdisease":"Disease","/app/mksymptom":"Symptom","/app/mkmedication":"Medication","/app/mklab":"Lab","/app/mkmedicare":"Medicare","/app/mkclinicalpathway":"Clinicalpath","/app/mkevidence":"Evidence","/app/mkresearch":"Research","/app/mkclinicalg":"Clinicalg","/app/mkvideo":"Video","/app/mkotherres":"Otherres"};e.mkCurrentPage=l[window.location.href.split("#")[1]]||"Disease",void 0,e.sidebarClicked=function(t){void 0,e.mkCurrentPage=t,e.$broadcast("mksidebarClicked",t)},e.settings={skin:"",color:{themeprimary:"#2dc3e8",themesecondary:"#fb6e52",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"},rtl:!1,fixed:{navbar:!1,sidebar:!1,breadcrumbs:!1,header:!1}},angular.isDefined(t.settings)?e.settings=t.settings:t.settings=e.settings,e.$watch("settings",function(){if(e.settings.fixed.header&&(e.settings.fixed.navbar=!0,e.settings.fixed.sidebar=!0,e.settings.fixed.breadcrumbs=!0),e.settings.fixed.breadcrumbs&&(e.settings.fixed.navbar=!0,e.settings.fixed.sidebar=!0),e.settings.fixed.sidebar){e.settings.fixed.navbar=!0;var a=e.settings.rtl?"right":"left";$(".page-sidebar").hasClass("menu-compact")||$(".sidebar-menu").slimscroll({position:a,size:"3px",color:e.settings.color.themeprimary,height:$(window).height()-90})}else $(".sidebar-menu").closest("div").hasClass("slimScrollDiv")&&($(".sidebar-menu").slimScroll({destroy:!0}),$(".sidebar-menu").attr("style",""));t.settings=e.settings},!0),e.$watch("settings.rtl",function(){"persian.dashboard"!=a.current.name&&"arabic.dashboard"!=a.current.name&&(switchClasses("pull-right","pull-left"),switchClasses("databox-right","databox-left"),switchClasses("item-right","item-left")),t.settings=e.settings},!0),e.$on("$viewContentLoaded",function(t,l,o,r,s){e.settings.rtl&&"persian.dashboard"!=a.current.name&&"arabic.dashboard"!=a.current.name&&(switchClasses("pull-right","pull-left"),switchClasses("databox-right","databox-left"),switchClasses("item-right","item-left")),"error404"==a.current.name&&$("body").addClass("body-404"),"error500"==a.current.name&&$("body").addClass("body-500"),n(function(){if(e.settings.fixed.sidebar){var t=e.settings.rtl?"right":"left";$(".page-sidebar").hasClass("menu-compact")||$(".sidebar-menu").slimscroll({position:t,size:"3px",color:e.settings.color.themeprimary,height:$(window).height()-90})}else $(".sidebar-menu").closest("div").hasClass("slimScrollDiv")&&($(".sidebar-menu").slimScroll({destroy:!0}),$(".sidebar-menu").attr("style",""))},500)})}]);var app=angular.module("app").config(["$controllerProvider","$compileProvider","$filterProvider","$provide","$httpProvider",function(e,t,a,n){app.controller=e.register,app.directive=t.directive,app.filter=a.register,app.factory=n.factory,app.service=n.service,app.constant=n.constant,app.value=n.value}]);app.config(["$breadcrumbProvider",function(e){e.setOptions({template:'<ul class="breadcrumb"><li><i class="fa fa-home"></i><a href="#">Home</a></li><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ul>'})}]),app.config(["$httpProvider",function(e){e.interceptors.push("httpReject")}]).config(["$anchorScrollProvider",function(e){e.disableAutoScrolling()}]),angular.module("app").run(["$rootScope","$state","$stateParams",function(e,t,a){e.$state=t,e.$stateParams=a}]).config(["$stateProvider","$urlRouterProvider",function(e,t){void 0,void 0,void 0,t.otherwise("searchStart"),e.state("app",{abstract:!0,url:"/app",templateUrl:"views/layout.html"}).state("app.knowledgeGraph",{url:"/knowledgeGraph",template:"<network-graph></network-graph>",ncyBreadcrumb:{label:"知识图谱",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.patientClinicalPathway",{url:"/patientClinicalPathway",templateUrl:"views/tpl/patientClinicalPathway.html",ncyBreadcrumb:{label:"患者信息展示",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.similarPatientsDia",{url:"/similarPatientsDia",templateUrl:"views/tpl/similarPatientsDia.html",ncyBreadcrumb:{label:"相似患者诊断分析",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.similarPatientsMed",{url:"/similarPatientsMed",templateUrl:"views/tpl/similarPatientsMed.html",ncyBreadcrumb:{label:"相似患者用药分析",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.diseaseCause",{url:"/diseaseCause",templateUrl:"views/tpl/diseaseCause.html",ncyBreadcrumb:{label:"疾病风险预测",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkdisease",{url:"/mkdisease",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"疾病",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||(void 0,e.$state.go("login"))}]}).state("app.mksymptom",{url:"/mksymptom",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"症状",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkmedication",{url:"/mkmedication",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"药品",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mklab",{url:"/mklab",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"辅助检查",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkmedicare",{url:"/mkmedicare",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"医保药品",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkclinicalpathway",{url:"/mkclinicalpathway",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"临床路径",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkevidence",{url:"/mkevidence",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"循证医学",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkresearch",{url:"/mkresearch",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"疾病研究",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkclinicalg",{url:"/mkclinicalg",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"临床指南",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkvideo",{url:"/mkvideo",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"视频库",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.mkotherres",{url:"/mkotherres",templateUrl:"views/tpl/medicalKnowledge.html",ncyBreadcrumb:{label:"其他资源",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.traditionalSyndrome",{url:"/mktraditionalSyndrome",templateUrl:"views/tpl/bianzhenglunzhi.html",controller:"traditionalSyndromeController",ncyBreadcrumb:{label:"辨证论治",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.traditionalTuinan",{url:"/mktraditionalTuinan",templateUrl:"views/tpl/traditionalTuinan.html",controller:"traditionalTuinanController",ncyBreadcrumb:{label:"针灸推拿",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.traditionalShiliao",{url:"/mktraditionalShiliao",templateUrl:"views/tpl/traditionalShiliao.html",controller:"traditionalShiliaoController",ncyBreadcrumb:{label:"药膳食疗",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.traditionalSearch",{url:"/mktraditionalSearch",templateUrl:"views/tpl/traditionalSearch.html",controller:"traditionalSearchController",ncyBreadcrumb:{label:"中药检索",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.cohortComparsion",{url:"/cohortComparsion/",templateUrl:"views/tpl/cohortComparsion.html",controller:"cohortComparsionController",ncyBreadcrumb:{label:"cohort comparsion",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.details",{url:"/details/:zid",templateUrl:"views/tpl/myModalContent.html",controller:"ModalInstanceCtrl",ncyBreadcrumb:{label:"details",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.clinicPath",{url:"/clinicPath",templateUrl:"views/tpl/clinicPath.html",ncyBreadcrumb:{label:"临床路径比较",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.medcareFee",{url:"/medcareFee",templateUrl:"views/tpl/medcareFee.html",ncyBreadcrumb:{label:"医保控费",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.AdvReaction1",{url:"/AdvReaction_1",templateUrl:"views/tpl/AdvReaction_1.html",ncyBreadcrumb:{label:"不良反应信息查询",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.AdvReaction2",{url:"/AdvReaction_2",templateUrl:"views/tpl/AdvReaction_2.html",ncyBreadcrumb:{label:"患者不良反应信息",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("app.UserCtrl",{url:"/users",templateUrl:"views/tpl/user.html",ncyBreadcrumb:{label:"用户信息管理",description:""},controllerProvider:["$rootScope",function(e){e.nodeToken||e.$state.go("login")}]}).state("login",{url:"/login",templateUrl:"views/tpl/login.html",ncyBreadcrumb:{label:"Login"}}).state("app.LowAuthority",{url:"/LowAuth",templateUrl:"views/tpl/LowAuthority.html",ncyBreadcrumb:{label:"LowAuth"}}).state("searchStart",{url:"/searchStart",templateUrl:"views/tpl/searchStart.html"})}]),angular.module("app").directive("loadingContainer",function(){return{restrict:"AC",link:function(e,t,a){t.removeClass("app-loading"),e.$on("$stateChangeStart",function(e){t.addClass("app-loading")}),e.$on("$stateChangeSuccess",function(e,a,n,l){e.targetScope.$watch("$viewContentLoaded",function(){t.removeClass("app-loading ")})})}}}),angular.module("app").directive("skinChanger",["$rootScope","$filter","$state","$stateParams",function(e,t,a,n){return{restrict:"AC",link:function(l,o,r){o.on("click",function(){setTimeout(function(){e.$apply(function(){var r=t("filter")(l.skins,function(e){return e.skin===o.attr("rel")})[0];e.settings.skin=r.skin,e.settings.color=r.color,a.transitionTo(a.current,n,{reload:!0,inherit:!1,notify:!0})})},100)}),l.skins=[{skin:"assets/css/skins/blue.min.css",color:{themeprimary:"#5db2ff",themesecondary:"#ed4e2a",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/azure.min.css",color:{themeprimary:"#2dc3e8",themesecondary:"#fb6e52",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/black.min.css",color:{themeprimary:"#474544",themesecondary:"#d73d32",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/darkblue.min.css",color:{themeprimary:"#0072c6",themesecondary:"#fb6e52",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/darkred.min.css",color:{themeprimary:"#ac193d",themesecondary:"#7bd148",themethirdcolor:"#5db2ff",themefourthcolor:"#e75b8d",themefifthcolor:"#ffce55"}},{skin:"assets/css/skins/deepblue.min.css",color:{themeprimary:"#001940",themesecondary:"#d73d32",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/deepblue.min.css",color:{themeprimary:"#001940",themesecondary:"#d73d32",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/gray.min.css",color:{themeprimary:"#585858",themesecondary:"#fb6e52",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/green.min.css",color:{themeprimary:"#53a93f",themesecondary:"#ed4e2a",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/orange.min.css",color:{themeprimary:"#ff8f32",themesecondary:"#7bd148",themethirdcolor:"#5db2ff",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/pink.min.css",color:{themeprimary:"#cc324b",themesecondary:"#8cc474",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#e75b8d"}},{skin:"assets/css/skins/purple.min.css",color:{themeprimary:"#8c0095",themesecondary:"#ffce55",themethirdcolor:"#e75b8d",themefourthcolor:"#a0d468",themefifthcolor:"#fb6e52"}},{skin:"assets/css/skins/teal.min.css",color:{themeprimary:"#03b3b2",themesecondary:"#ed4e2a",themethirdcolor:"#ffce55",themefourthcolor:"#a0d468",themefifthcolor:"#fb6e52"}}]}}}]),angular.module("app").directive("sidebarMenu",function(){return{restrict:"AC",link:function(e,t,a){function n(){var t=document.createElement("iframe");e.chatbotAction="Waiting ......",void 0,t.id="botIframe",t.src="http://59.110.52.133:3002",t.width=400,t.height=600,void 0,t.onload=function(){e.chatbotAction="Close Chatbot",e.$apply()},$("#botDiv").append(t)}function l(){void 0,$("#botIframe").remove(),e.chatbotAction="Open Chatbot"}e.chatbotAction="Open Chatbot",e.chatbotVisStyle={display:"block"},$(document).keydown(function(t){var a=e.chatbotVisStyle;void 0,192===t.keyCode&&(a.display="block"===a.display?"none":"block",void 0,e.$apply())}),e.openOrCloseChatbot=function(){"Open Chatbot"===e.chatbotAction?n():l()},e.testBot=function(){var e,t=$("#botDiv");e=600===t.height()?38:600,t.height(e),void 0},e.testBot(),t.find("li.active").parents("li").addClass("active open"),t.on("click","a",function(e){e.preventDefault();var t=$("#sidebar").hasClass("menu-compact"),a=$(e.target);if($(e.target).is("span")&&(a=$(e.target).closest("a")),a&&0!=a.length){if(!a.hasClass("menu-dropdown")){if(t&&a.get(0).parentNode.parentNode==this){var n=a.find(".menu-text").get(0);if(e.target!=n&&!$.contains(n,e.target))return!1}return void window.scrollTo(0,0)}var l=a.next().get(0);if(!$(l).is(":visible")){var o=$(l.parentNode).closest("ul");if(t&&o.hasClass("sidebar-menu"))return;o.find("* > .open > .submenu").each(function(){this==l||$(this.parentNode).hasClass("active")||$(this).slideUp(200).parent().removeClass("open")})}return(!t||!$(l.parentNode.parentNode).hasClass("sidebar-menu"))&&($(l).slideToggle(200).parent().toggleClass("open"),window.scrollTo(0,0),!1)}})}}}),angular.module("app").directive("fullscreen",function(){return{restrict:"AC",template:'<i class="glyphicon glyphicon-fullscreen"></i>',link:function(e,t){t.on("click",function(){var e=document.documentElement;$("body").hasClass("full-screen")?($("body").removeClass("full-screen"),t.removeClass("active"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):($("body").addClass("full-screen"),$("#fullscreen-toggler").addClass("active"),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())})}}}),angular.module("app").directive("refresh",["$rootScope","$state","$stateParams",function(e,t,a){return{restrict:"AC",template:'<i class="glyphicon glyphicon-refresh"></i>',link:function(e,n){n.on("click",function(){t.transitionTo(t.current,a,{reload:!0,inherit:!1,notify:!0})})}}}]),angular.module("app").directive("sidebarToggler",function(){return{restrict:"AC",template:'<i class="fa fa-arrows-h"></i>',link:function(e,t){t.on("click",function(){return $("#sidebar").toggleClass("hide"),t.toggleClass("active"),!1})}}}),angular.module("app").directive("pageTitle",["$rootScope","$timeout",function(e,t){return{link:function(a,n){var l=function(e,a){var l="Default Title";a.ncyBreadcrumb&&a.ncyBreadcrumb.label&&(l=a.ncyBreadcrumb.label),t(function(){n.text(l)},0,!1)};e.$on("$stateChangeSuccess",l)}}}]),angular.module("app").directive("headerTitle",["$rootScope","$timeout",function(e,t){return{link:function(a,n){var l=function(e,a){var l="Default Title",o="";a.ncyBreadcrumb&&a.ncyBreadcrumb.label&&(l=a.ncyBreadcrumb.label),a.ncyBreadcrumb&&a.ncyBreadcrumb.description&&(o=a.ncyBreadcrumb.description),t(function(){""==o?n.text(l):n.html(l+' <small> <i class="fa fa-angle-right"> </i> '+o+" </small>")},0,!1)};e.$on("$stateChangeSuccess",l)}}}]),angular.module("app").directive("sidebarCollapse",function(){return{restrict:"AC",template:'<i class="collapse-icon fa fa-bars"></i>',link:function(e,t,a){t.on("click",function(){$("#sidebar").is(":visible")||$("#sidebar").toggleClass("hide"),$("#sidebar").toggleClass("menu-compact"),$(".sidebar-collapse").toggleClass("active");var e=$("#sidebar").hasClass("menu-compact");if($(".sidebar-menu").closest("div").hasClass("slimScrollDiv")&&($(".sidebar-menu").slimScroll({destroy:!0}),$(".sidebar-menu").attr("style","")),e)$(".open > .submenu").removeClass("open");else if($(".page-sidebar").hasClass("sidebar-fixed")){var t=readCookie("rtl-support")||"/index-rtl-fa.html"==location.pathname||"/index-rtl-ar.html"==location.pathname?"right":"left";$(".sidebar-menu").slimscroll({height:$(window).height()-90,position:t,size:"3px",color:themeprimary})}})}}}),angular.module("app").directive("setting",function(){return{restrict:"AC",template:'<a id="btn-setting" title="Setting" href="#"><i class="icon glyphicon glyphicon-cog"></i></a>',link:function(e,t,a){t.on("click",function(){$(".navbar-account").toggleClass("setting-open")})}}}),angular.module("app").directive("widgetMaximize",function(){return{restrict:"A",template:'<i class="fa fa-expand"></i>',link:function(e,t,a){t.on("click",function(){var e=t.parents(".widget").eq(0),a=t.find("i").eq(0),n="fa-compress",l="fa-expand";if(e.hasClass("maximized"))a&&a.addClass(l).removeClass(n),e.removeClass("maximized"),e.find(".widget-body").css("height","auto");else if(a&&a.addClass(n).removeClass(l),e.addClass("maximized"),e){var o=$(window).height(),r=e.find(".widget-header").height();e.find(".widget-body").height(o-r)}})}}}),angular.module("app").directive("widgetCollapse",function(){return{restrict:"A",template:'<i class="fa fa-minus"></i>',link:function(e,t,a){t.on("click",function(){var e=t.parents(".widget").eq(0),a=e.find(".widget-body"),n=t.find("i"),l="fa-plus",o="fa-minus",r=300,s=200;e.hasClass("collapsed")?(n&&n.addClass(o).removeClass(l),e.removeClass("collapsed"),a.slideUp(0,function(){a.slideDown(r)})):(n&&n.addClass(l).removeClass(o),a.slideUp(s,function(){e.addClass("collapsed")}))})}}}),angular.module("app").directive("widgetExpand",function(){return{restrict:"A",template:'<i class="fa fa-plus"></i>',link:function(e,t,a){t.on("click",function(){var e=t.parents(".widget").eq(0),a=e.find(".widget-body"),n=t.find("i"),l="fa-plus",o="fa-minus",r=300,s=200;e.hasClass("collapsed")?(n&&n.addClass(o).removeClass(l),e.removeClass("collapsed"),a.slideUp(0,function(){a.slideDown(r)})):(n&&n.addClass(l).removeClass(o),a.slideUp(s,function(){e.addClass("collapsed")}))})}}}),angular.module("app").directive("widgetDispose",function(){return{restrict:"A",template:'<i class="fa fa-times"></i>',link:function(e,t,a){t.on("click",function(){var e=t.parents(".widget").eq(0),a=300;e.hide(a,function(){e.remove()})})}}}),angular.module("app").directive("widgetConfig",function(){return{restrict:"A",template:'<i class="fa fa-cog"></i>',link:function(e,t,a){t.on("click",function(){})}}}),angular.module("app").directive("widgetRefresh",function(){return{restrict:"A",template:'<i class="fa fa-undo"></i>',link:function(e,t,a){t.on("click",function(){})}}}),angular.module("app").directive("networkGraph",["$http","Data","$q","$compile","$timeout","$rootScope","$location",function(e,t,a,n,l,o,r){return{templateUrl:"views/tpl/knowledgeGraph.html",restrict:"E",scope:{data:"="},link:function(e,s,i){function c(e,t){$("#circlePack svg").remove(),cy.$(".added").remove();var a=e.closedNeighborhood();cy.batch(function(){function t(){1===a.length&&e.layout({name:"preset",padding:300,animate:!0,animationDuration:f,fit:!0,stop:function(){}}),a.addClass("detail").difference(e).layout({name:"preset",animate:!0,animationDuration:100,fit:!1,positions:function(t){var a={x:e._private.data.orgPos.x+Math.sin(2*Math.PI*(o-1)/n)*l,y:e._private.data.orgPos.y-Math.cos(2*Math.PI*(o-1)/n)*l};return o++,a},stop:function(){cy.animate({fit:{eles:a,padding:30},duration:500,complete:function(){}})}})}var n=0;a.forEach(function(e){"nodes"===e._private.group&&n++}),n--;var l=100,o=1;cy.panningEnabled(!0),cy.zoomingEnabled(!0).delay(0,function(){cy.$(".highlighted").forEach(function(e){e.animate({position:e.data("orgPos")})})}).delay(500,function(){cy.elements().not(a).removeClass("highlighted").addClass("faded"),a.removeClass("faded").addClass("highlighted"),cy.animate({fit:{eles:cy.elements(),padding:30}},{duration:500})}).delay(500,function(){t()})})}function d(e){var t=new Array(e.length);e.forEach(function(e,a){var n=e.position().x,l=e.position().y,o=90,r=50;t[a]=new cola.vpsc.Rectangle(n,n+o,l,l+r)}),cola.vpsc.removeOverlaps(t),e.forEach(function(e,a){var n=t[a];e.animate({position:{x:n.x,y:n.y}},{duration:100})})}function u(){void 0,cy.$(".added").remove(),cy.panningEnabled(!0),cy.zoomingEnabled(!0).delay(0,function(){cy.nodes().forEach(function(e){e.animate({position:e.data("orgPos")})})}).delay(500,function(){cy.animate({fit:{eles:cy.elements(),padding:h},duration:500,complete:function(){d(cy.nodes())}})}),cy.elements().removeClass("highlighted").removeClass("faded").removeClass("detail").removeClass("selected").removeClass("added").removeClass("hover-highlight").removeClass("hover-fade")}function g(t){var a=1;void 0,void 0;var n=t[0].data||t[0];e.firstInit&&(void 0,e.allElements=jQuery.extend(!0,{},t),e.firstInit=0),void 0;var l=t[1],o=jQuery.extend(!0,{},n.elements||n);if(e.$broadcast("graphElements",o),void 0,1==o.return&&$("#errorModal").modal("toggle"),void 0,void 0,1==e.levelMode)for(var r=0;r<o.edges.length;)o.edges[r].data.level&&2==o.edges[r].data.level?o.edges.splice(r,1):r++;void 0;for(var s=(o.nodes.sort(function(e,t){return e.data.name==t.data.name?"yes"==e.data.center?-1:"yes"==t.data.center?1:0:e.data.name>t.data.name?-1:e.data.name<t.data.name?1:void 0}),[]),i=[],g=0,r=0;r<o.nodes.length-1;){for(var p=[],h=0;o.nodes[r].data.name&&o.nodes[r+1]&&o.nodes[r].data.name==o.nodes[r+1].data.name;){var f=o.nodes[r+1].data,v=o.nodes[r].data;f.id!==v.id&&i.push({oldId:f.id,newId:v.id}),o.nodes[r+1].data.id=o.nodes[r].data.id,h||(o.nodes[r].data.isSuper=1,o.nodes[r].data.superNum=g,g++,p.push(o.nodes[r]),h=1),o.nodes[r+1].data.isSuper=1,p.push(o.nodes[r+1]),r++}r++,h&&s.push(p)}for(o.edges.forEach(function(e){i.forEach(function(t){t.oldId===e.data.source&&(e.data.source=t.newId),t.oldId===e.data.target&&(e.data.target=t.newId)})}),o.edges.sort(function(e,t){return e.data.source!==t.data.source?e.data.source>t.data.source?1:e.data.source<t.data.source?-1:0:e.data.target>t.data.target?1:e.data.target<t.data.target?-1:0}),r=o.edges.length-2;r>-1;)o.edges[r+1]&&o.edges[r].data.source===o.edges[r+1].data.source&&o.edges[r].data.target===o.edges[r+1].data.target&&o.edges.splice(r+1,1),o.edges[r]&&o.edges[r].data.source==o.edges[r].data.target&&o.edges.splice(r,1),r--;var b=[],y=50;s.forEach(function(e){var t={name:" ",children:[]};e.forEach(function(e){var a={name:e.data.name,size:y};t.children.push(a);
}),b.push(t)}),e.filterEdgeItems=[],o.edges.forEach(function(t){e.filterEdgeItems.indexOf(t.data.relation)==-1&&e.filterEdgeItems.push(t.data.relation)}),e.filterNodeItems=[],e.nItemsCh={disease:"疾病",symptom:"症状",lab:"辅助检查",medicine:"药品",fclass:"一级科室",sclass:"二级科室",fbody:"一级部位",sbody:"二级部位",dclass:"科室"},o.nodes.forEach(function(t){void 0,e.filterNodeItems.indexOf(t.data.type)==-1&&e.filterNodeItems.push(t.data.type)}),e.isGraphLoading=!1,$("#circlePack svg").remove();var C=window.cy=cytoscape({container:document.getElementById("cy"),layout:{name:"cola",animate:!0,refresh:1,maxSimulationTime:1e3,ungrabifyWhileSimulating:!1,fit:!0,padding:30,infinite:!1,randomize:!0,avoidOverlap:!1,handleDisconnected:!1,nodeSpacing:function(e){return 0},flow:void 0,edgeLength:void 0,edgeSymDiffLength:void 0,edgeJaccardLength:void 0,stop:function(){void 0;var t;if(C.nodes("[center='yes']").length>0){d(C.nodes()),C.autoungrabify(!1),t=C.nodes("[center='yes']")[0]._private.data;var a=[t.id,t.name],n=function(t){t=t||"",store.has("hID"+t)||store.set("hID"+t,0);for(var n,l=store.get("hID"+t),o=1,r=0;r<10;r++)store.get("historyItem"+t+(l+r)%10)&&store.get("historyItem"+t+(l+r)%10).id===a[0]&&(o=0,n=(l+r)%10);if(o)store.set("historyItem"+t+l,{id:a[0],name:a[1],searched:1}),l++,l%=10,store.set("hID"+t,l),e.$emit("historyUpdate",1);else{for(var s=store.get("historyItem"+t+n),r=(n+1)%10;r!=l;r=(r+1)%10)store.remove("historyItem"+t+(r+9)%10),store.set("historyItem"+t+(r+9)%10,store.get("historyItem"+t+r));store.remove("historyItem"+t+(l+9)%10),store.set("historyItem"+t+(l+9)%10,s),e.$emit("historyUpdate",1)}};n(),n(t.type),void 0}},ready:function(){if(1===C.nodes("[center='yes']").length){var t=C.nodes("[center='yes']")[0],a=0,n=0,l=0;C.nodes().difference(t).forEach(function(e){a++,n+=e._private.position.x,l+=e._private.position.y}),t._private.position.x=n/a,t._private.position.y=l/a,void 0,void 0,void 0,void 0}void 0,$("#errorModal").modal("hide"),e.filter.isFilterShow=!0},unconstrIter:20,userConstIter:0,allConstIter:10,r:75,centerPos:{x:window.innerWidth/2.8,y:375},gravity:0},style:l,elements:o,motionBlur:!0,selectionType:"single",boxSelectionEnabled:!1,autoungrabify:!0});C.panzoom({}),e.$on("getDiseaseIds",function(t,a){C.destroy(),e.isSearchingDisease=!0,e.isSearchingMedicine=!1}),e.$on("getMedicineIds",function(t,a){C.destroy(),e.isSearchingDisease=!1,e.isSearchingMedicine=!0}),e.$on("submitQuery",function(t,a){e.isSearchingDisease=!1,e.isSearchingMedicine=!1,C.destroy(),$("#circlePack svg").remove()}),e.$on("getDiseaseIds",function(e,t){C.destroy(),$("#circlePack svg").remove()}),e.$on("getMedicineIds",function(e,t){C.destroy(),$("#circlePack svg").remove()}),e.$on("nodeMouseover",function(e,t){i.forEach(function(e){e.oldId===t&&(t=e.newId)});var a=C.$("#"+t);a.addClass("hoverd");for(var n=1;C.$("#"+t+"_"+n).length>0;)C.$("#"+t+"_"+n).addClass("hoverd"),n++;C.elements().not(C.$(".hoverd").closedNeighborhood().difference(C.$(".filtered")).addClass("hover-highlight")).addClass("hover-fade")}),e.$on("nodeMouseleave",function(e,t){i.forEach(function(e){e.oldId===t&&(t=e.newId)});var a=C.$("#"+t);a.removeClass("hoverd");for(var n=1;C.$("#"+t+"_"+n).length>0;)C.$("#"+t+"_"+n).removeClass("hoverd"),n++;C.elements().removeClass("hover-fade").removeClass("hover-highlight")}),C.on("mouseover","node",function(t){var a=this;a.addClass("hoverd"),void 0,e.$broadcast("nodeHovered",a._private.data.id),$("#search").parent().css("display","block");for(var n=1;C.$("#"+a._private.data.id+"_"+n).length>0;)C.$("#"+a._private.data.id+"_"+n).addClass("hoverd"),n++;C.elements().not(C.$(".hoverd").closedNeighborhood().addClass("hover-highlight")).addClass("hover-fade")}),C.on("mouseout","node",function(t){var a=this;a.removeClass("hoverd"),e.$broadcast("nodeNotHovered",a._private.data.id);for(var n=1;C.$("#"+a._private.data.id+"_"+n).length>0;)C.$("#"+a._private.data.id+"_"+n),C.$("#"+a._private.data.id+"_"+n).removeClass("hoverd"),n++;C.elements().removeClass("hover-fade").removeClass("hover-highlight")}),C.on("select","node",function(t){a&&(C.nodes().forEach(function(e){e._private.data.orgPos={x:e._private.position.x,y:e._private.position.y}}),a=0);var n=this;if(n._private.data.id.indexOf("_")!==-1)return 0;n.addClass("selected");var l=n._private.data.type;event.ctrlKey===!0?"disease"!=l&&"medicine"!=l&&"symptom"!=l&&"lab"!=l||(e.isGraphLoading=!0,e.item=n._private.data.id,m(e.item),C.destroy(),$("#circlePack svg").remove()):c(n,b)}),C.on("tap",function(e){e.cyTarget===C&&u()})}o.nodeToken||(void 0,r.path("/login")),void 0,$("#cy,#myDetailsTable").height(window.innerHeight-150);var p=o.errorModal={};p.unneededAPI={},e.firstInit=1,e.levelMode=!0,e.filter={},e.filter.isFilterShow=!1,e.filter.isCollapsed=!0,e.$on("submitQuery",function(t,a){o.errorModal.unneededAPI={},p.apiTimestamp=(new Date).getTime(),e.item=a,m(a)}),e.$on("getDiseaseIds",function(r,s){o.errorModal.unneededAPI.apiTimestamp=0,p.apiTimestamp=(new Date).getTime(),void 0,void 0,void 0,e.isSearchingDisease=!0,e.isGraphLoading=!0,e.$broadcast("graphElements",{nodes:""});var i=t.getDisRelation(s),c=t.getNetworkStyle();e.modalTimer=l(function(){void 0,p.isWaitingForAPI=1;var t='<p>正在等待数据<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></p>',a=n(t)(e);angular.element("#modalTimeOutDetails").html(a),$("#errorModal").modal("show")},1e3),e.firstInit=1,a.all([i,c]).then(function(t){return l.cancel(e.modalTimer),void 0,t[0].unneeded&&1==t[0].unneeded?(e.filter.isFilterShow=!1,void 0,0):void g(t)},function(t){if(p.isWaitingForAPI=0,void 0,p.unneededAPI&&p.unneededAPI.apiTimestamp!=t.config.requestTimestamp){var a="<p>等待数据超时，请重新设置<p>",l=n(a)(e);angular.element("#modalTimeOutDetails").html(l),$("#errorModal").modal("show")}})}),e.$on("getMedicineIds",function(r,s){o.errorModal.unneededAPI.apiTimestamp=0,p.apiTimestamp=(new Date).getTime(),void 0,void 0,void 0,e.isSearchingDisease=!0,e.isGraphLoading=!0,e.$broadcast("graphElements",{nodes:""});var i=t.getMedRelation(s),c=t.getNetworkStyle();e.modalTimer=l(function(){void 0,p.isWaitingForAPI=1;var t='<p>正在等待数据<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></p>',a=n(t)(e);angular.element("#modalTimeOutDetails").html(a),$("#errorModal").modal("show")},1e3),e.firstInit=1,a.all([i,c]).then(function(t){return l.cancel(e.modalTimer),void 0,t[0].unneeded&&1==t[0].unneeded?(e.filter.isFilterShow=!1,void 0,0):void g(t)},function(t){if(p.isWaitingForAPI=0,void 0,p.unneededAPI&&p.unneededAPI.apiTimestamp!=t.config.requestTimestamp){var a="<p>等待数据超时，请重新设置<p>",l=n(a)(e);angular.element("#modalTimeOutDetails").html(l),$("#errorModal").modal("show")}})}),$("#errorModal").on("hidden.bs.modal",function(t){void 0,e.isGraphLoading=!1,e.filter.isFilterShow=!1});var m=function(n){e.isGraphLoading=!0;var l=t.getNetworkData(n),o=t.getNetworkStyle();e.firstInit=1,a.all([l,o]).then(g)};e.gotoAnchor=function(e){e="#"+e,anchorScroll.toView(e,!0,".modal-body")};var h=30,f=500;Handlebars.compile(['<p class="ac-name">{{name}}</p>','<p class="ac-node-type"><i class="fa fa-info-circle"></i> {{NodeTypeFormatted}} {{#if Type}}({{Type}}){{/if}}</p>','{{#if Milk}}<p class="ac-milk"><i class="fa fa-angle-double-right"></i> {{Milk}}</p>{{/if}}','{{#if Country}}<p class="ac-country"><i class="fa fa-map-marker"></i> {{Country}}</p>{{/if}}','<p class="ac-more"><i class="fa fa-external-link"></i> <a target="_blank" href="https://duckduckgo.com/?q={{name}}">More information</a></p>'].join(""));e.edgeFilterClick=function(t){void 0,void 0,void 0;var a=cy.edges().filterFn(function(e){return e.data("relation")==t});$("#"+t).is(":checked")?(a.removeClass("filtered"),a.connectedNodes().removeClass("filtered")):(a.addClass("filtered"),a.connectedNodes().forEach(function(e){var t=0;e.connectedEdges().forEach(function(e){e.hasClass("filtered")||(t=1)}),0===t&&e.addClass("filtered")})),void 0,void 0},e.nodeFilterClick=function(t){void 0,void 0,void 0;var a=cy.nodes().filterFn(function(e){return e.data("type")==t});void 0,$("#"+t).is(":checked")?a.connectedEdges().union(a).removeClass("filtered"):a.connectedEdges().union(a).addClass("filtered"),void 0,void 0},e.edgeReverseClick=function(){for(var t=e.filterEdgeItems,a=0;a<t.length;a++){var n=$("#"+t[a])[0];n.checked=!n.checked,e.edgeFilterClick(t[a])}},e.nodeReverseClick=function(){for(var t=e.filterNodeItems,a=0;a<t.length;a++){var n=$("#"+t[a])[0];0==n.disabled&&(n.checked=!n.checked,e.nodeFilterClick(t[a]))}},e.allClickChoose={},e.allClickChoose.edge=!1,e.allClickChoose.node=!1,e.allClickChoose.edgeAllClick=function(){for(var t=e.filterEdgeItems,a=0;a<t.length;a++){var n=$("#"+t[a])[0];n.checked!==e.allClickChoose.edge&&(n.checked=e.allClickChoose.edge,e.edgeFilterClick(t[a]))}e.allClickChoose.edge=!e.allClickChoose.edge},e.allClickChoose.showLevel2=function(){void 0,void 0,cy.destroy(),e.isGraphLoading=!0,e.levelMode=!e.levelMode,$("#showLevel2_1")[0].checked=!e.levelMode,$("#showLevel2_2")[0].checked=!e.levelMode,void 0,g(e.allElements)},e.allClickChoose.nodeAllClick=function(){for(var t=e.filterNodeItems,a=0;a<t.length;a++){var n=$("#"+t[a])[0];n.checked!==e.allClickChoose.node&&0==n.disabled&&(n.checked=e.allClickChoose.node,e.nodeFilterClick(t[a]))}e.allClickChoose.node=!e.allClickChoose.node},$("#refresh").on("click",function(){cy.destroy(),e.isSearchingDisease?$("#searchDisease").trigger("click"):e.isSearchingMedicine?$("#searchMedicine").trigger("click"):m(e.item)}),$("#reset").on("click",function(){cy.animate({fit:{eles:cy.elements(),padding:h},duration:f})}),o.pageLoading=!1}}}]),angular.module("app").controller("DiseaseCauseStatisticsController",DiseaseCauseStatisticsController),angular.module("app").controller("GraphQueryController",GraphQueryController),angular.module("app").controller("mainController",["$scope","Data","$interval","$location","$rootScope",function(e,t,a,n,l){var o=e.navSearch={};o.types=[{label:"疾病",value:"dis"},{label:"症状",value:"sym"},{label:"辅助检查",value:"lab"},{label:"药品",value:"med"}],o.getStates=function(e,a){l.errorModal.unneededAPI.apiTimestamp=0,o.isItemsLoading=!0,o.itemsReturn=[];var n={filterbydomain:e||"",filterbyfirst:a||"",filterbyfclass:"",filterbysclass:"",filterbyfbody:"",filterbysbody:"",filterbynumber:"10"},r=t.getFilterData(n).then(function(e){for(var t=0;t<e.elements.length;t++)e.elements[t].ename?o.itemsReturn.push({label:e.elements[t].name+"("+e.elements[t].ename+")",value:e.elements[t].value}):o.itemsReturn.push({label:e.elements[t].name,value:e.elements[t].value});return o.isItemsLoading=!1,o.itemsReturn});return r},o.recordItem=function(t,a){e.$emit("submitQuery",t.value)},o.submitQuery=function(t){void 0,void 0;for(var a,n=0;n<o.itemsReturn.length;n++)o.itemsReturn[n].label==t&&(a=o.itemsReturn[n].value);return a?(store.set("currentId",a),void e.$emit("submitQuery",a)):(void 0,0)}}]),function(){function e(e,t,a,n,l){function o(){m=f.currentPage,f.currentPage=f.tempPage,f.tempPage=m}function r(){s(0,"init"),f.isItemsLoading=!1}function s(e,a){var l='http://59.110.52.133:3010/api/transfer/?q={"path":"/medknowledge/search","params":{%22QueryString%22:%22'+f.queryString+"%22,%22Start%22:"+e+",%22Offset%22:"+x+"}}";void 0,f.listItems=[],t.pageLoading=!0,n.get(l).then(function(e){var n=e.data,l=f.currentPage;void 0,f.listItems=n.Results,l="init"===a?1:l,f.totalPages=Math.ceil(n.Count/x),void 0,d(l),t.pageLoading=!1})}function i(){n.get('http://59.110.52.133:3010/api/transfer/?q={"path":"/medknowledge/list","params":{%22Table%22:%22'+v+"%22,%22Start%22:0,%22Offset%22:"+k+",%22SortItem%22:%22"+b+"%22,%22Filter%22:{}}}").then(function(e){var t=e.data;f.tableData=t.Results,void 0,f.totalPages=Math.ceil(t.TotalCount/k),g=f.tableData[0],p=0;for(u in g)g.hasOwnProperty(u)&&(f.orders[u]=0,1===p&&(f.orders[u]=!0),p++);for(p=f.totalPages<S?f.totalPages:S,h=0;h<p;h++)f.pages.push(C+h)})}function c(e,a){var l='http://59.110.52.133:3010/api/transfer/?q={"path":"/medknowledge/list","params":{%22Table%22:%22'+v+"%22,%22Start%22:"+e+",%22Offset%22:"+k+",%22SortItem%22:%22"+a+"%22,%22Filter%22:"+JSON.stringify(f.filters)+"}}";void 0,t.pageLoading=!0,void 0,n.get(l).then(function(e){var a=e.data,n=f.currentPage;t.pageLoading=!1,void 0,f.totalPages=Math.ceil(a.TotalCount/k),void 0,f.tableData=a.Results,d(n),void 0})}function d(e){var t;if(void 0,f.pages=[],e<S/2)for(void 0,p=f.totalPages<S?f.totalPages:S,h=0;h<p;h++)f.pages.push(1+h),e===1+h&&(f.currentPageIndex=h);else if(e>f.totalPages-S/2)for(void 0,p=f.totalPages<S?f.totalPages:S,h=p;h>0;h--)t=f.totalPages-h+1,f.pages.push(t),e===t&&(f.currentPageIndex=p-h);else for(void 0,C=e-Math.ceil(S/2)+1,h=0;h<S;h++)t=C+h,f.pages.push(t),e===t&&(f.currentPageIndex=h)}var u,g,p,m,h,f=e.mkvm={},v=t.mkCurrentPage,b="",y=[!0,!1,0],C=1,S=10,k=20,x=10,w=b;void 0,void 0,t.pageLoading=!1,f.currentType=v,f.isListShow=!1,f.currentPage=1,f.orders={},f.filters={},f.pages=[],f.currentPageIndex=0,i(),f.showdetails=function(e,t){e&&t&&(a.generateModal(),a.triggerModal(e,t))},f.filter=function(){void 0,void 0,f.changePage(1)},f.changeOrder=function(e){var t,a=f.orders[e];a=f.orders[e]=y[(y.indexOf(a)+1)%3];for(t in f.orders)f.orders.hasOwnProperty(t)&&t!==e&&(f.orders[t]=0);a===!1?w="-"+e:a===!0?w=e:0===a?w="":void 0,void 0,c((f.currentPage-1)*k,w)},f.changePage=function(e){e<1||e>f.totalPages&&f.totalPages>0||(f.currentPage=e,f.isListShow===!1?c((f.currentPage-1)*k,w):s((f.currentPage-1)*x))},f.getStates=function(e){return f.isItemsLoading=!0,n({method:"GET",url:'http://59.110.52.133:3010/api/transfer/?q={"path":"/medknowledge/auto","params":{%22QueryString%22:%22'+e+"%22}}"}).then(function(e){if(f.isItemsLoading=!1,void 0,void 0,0===e.data.Return)return e.data.Results})},f.searchItem=function(){f.tempPage=f.currentPage,r(),f.isListShow=!0},f.back2Table=function(){f.isListShow=!f.isListShow,o(),c((f.currentPage-1)*k,w)},f.back2List=function(){f.isListShow=!f.isListShow,o(),s((f.currentPage-1)*x)}}e.$inject=["$scope","$rootScope","medicalKnowledgeModal","$http","$location"],angular.module("app").controller("medicalKnowledgeController",e)}(),angular.module("app").controller("patientClinicalPathwayController",PatientClinicalPathwayController),angular.module("app").controller("sankeyController",["$scope","Data","SPDiagnosisSharedDataService","$interval","$location","$rootScope",function(e,t,a,n,l,o){function r(e){var t;switch(typeof e){case"undefined":break;case"string":t=e+"";break;case"number":t=e-0;break;case"boolean":t=e;break;case"object":if(null===e)t=null;else if(e instanceof Array){t=[];for(var a=0,n=e.length;a<n;a++)t.push(r(e[a]))}else{t={};for(var l in e)t[l]=r(e[l])}break;default:t=e}return t}e.cohortslist={},e.patients=10,e.patterns=2,e.indexs=-1,e.eventsByID_cpy={},e.eventsByID={},e.sandata={},e.frequency=[],e.$on("STARTRENDER",function(t,a){e.drawSankey()}),e.drawSankey=function(){var t=a.getData();e.sandata=t.sankeyData,e.cohortslist=t.cohortslist,e.dealSankeyData()},e.dealSankeyData=function(){e.eventsByID=r(e.sandata[0].Similarities),e.eventsByID_cpy=r(e.sandata[0].Similarities),e.createData_new()},e.createData_new=function(){$("#chart_sankeys svg g").html("");var t=e.eventsByID,a=e.patterns,n=[],l=0;for(e.patients;l<e.patients&&l<t.length;l++){for(var o=t[l].RefTime,s=0,i=0,c=t[l].Sequences.length-1;i<c;i++)t[l].Sequences[i].key==o&&(s=i);for(var i=0,c=2*a;i<c&&i<8;i++){var d=s+i;if(d>t[l].Sequences.length-1)n.push({source:"_"+i,target:"_"+(i+1),value:1});else if(d==t[l].Sequences.length-1){var u=r(t[l].Sequences[d].values);u=d3.keys(d3.nest().key(function(e){return e.HIERARCHY}).map(u));for(var g=0,p=u.length;g<p;g++)"undefined"==u[g]?n.push({source:"检验化验_"+i,target:"_"+(i+1),value:1}):n.push({source:u[g]+"_"+i,target:"_"+(i+1),value:1})}else{var u=r(t[l].Sequences[d].values),m=r(t[l].Sequences[d+1].values);u=d3.keys(d3.nest().key(function(e){return e.HIERARCHY}).map(u)),m=d3.keys(d3.nest().key(function(e){return e.HIERARCHY}).map(m));for(var g=0,p=u.length;g<p;g++)for(var h=0,f=m.length;h<f;h++)"undefined"==u[g]?n.push({source:"检验化验_"+i,target:m[h]+"_"+(i+1),value:1}):"undefined"==m[h]?n.push({source:u[g]+"_"+i,target:"检验化验_"+(i+1),value:1}):n.push({source:u[g]+"_"+i,target:m[h]+"_"+(i+1),value:1})}}}e.createSankey(n)},e.$on("TreeDataChange",function(t,a){var n=e.eventsByID,l=a.item;if("checked"==a.value){for(var o=0;o<n.length;o++){for(var r=n[o].Sequences,s=0;s<r.length;s++){for(var i=r[s].values,c=0;c<i.length;c++)1==l.level?(l.id=i[c].FTYPE)&&(i[c]={}):2==l.level?l.id==i[c].HIERARCHY&&(i[c]={}):l.id==i[c].NAMECN&&l.pid==i[c].HIERARCHY&&(i[c]={});r[s].values=i}n[o].Sequences=r}e.eventsByID=n}else for(var d=e.eventsByID_cpy,o=0;o<d.length;o++)for(var r=d[o].Sequences,s=0;s<r.length;s++)for(var i=r[s].values,c=0;c<i.length;c++)1==l.level?e.eventsByID[o].Sequences[s].values[c]=i[c]:2==l.level?l.id==i[c].HIERARCHY&&(e.eventsByID[o].Sequences[s].values[c]=i[c]):l.id==i[c].NAMECN&&l.pid==i[c].HIERARCHY&&(e.eventsByID[o].Sequences[s].values[c]=i[c]);e.createData_new()}),e.createSankey=function(e){function t(e){d3.select(this).attr("transform","translate("+e.x+","+(e.y=Math.max(0,Math.min(o-e.dy,d3.event.y)))+")"),d.relayout(),p.attr("d",u)}var a="Widgets",n={top:10,right:20,bottom:10,left:10},l=$("#chart_sankeys").width()-n.left-n.right,o=1e3-n.top-n.bottom,r=d3.format(",.0f"),s=function(e){return r(e)+" "+a},i=d3.scale.category20();$("#chart_sankeys").html("");var c=d3.select("#chart_sankeys").append("svg").attr("width",l+n.left+n.right).attr("height",o+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),d=d3.sankey().nodeWidth(36).nodePadding(40).width(.9*$("#chart_sankeys").width()).size([l,o]),u=d.link(),g={nodes:[],links:[]};e.forEach(function(e){g.nodes.push({name:e.source}),g.nodes.push({name:e.target}),g.links.push({source:e.source,target:e.target,value:e.value})}),g.nodes=d3.keys(d3.nest().key(function(e){return e.name}).map(g.nodes)),g.links.forEach(function(e,t){g.links[t].source=g.nodes.indexOf(g.links[t].source),g.links[t].target=g.nodes.indexOf(g.links[t].target)}),g.nodes.forEach(function(e,t){g.nodes[t]={name:e}}),d.nodes(g.nodes).links(g.links).layout(32);var p=c.append("g").selectAll(".link").data(g.links).enter().append("path").attr("class","link").attr("d",u).style("stroke-width",function(e){return Math.max(1,e.dy)}).style("display",function(e,t){return 2==e.source.name.length||2==e.target.name.length?"none":"block"}).style("stroke","#000").style("stroke-opacity",.2).sort(function(e,t){return t.dy-e.dy});p.append("title").text(function(e){return e.source.name+" → "+e.target.name+"\n"+s(e.value)});var m=c.append("g").selectAll(".node").data(g.nodes).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).call(d3.behavior.drag().origin(function(e){return e}).on("dragstart",function(){this.parentNode.appendChild(this)}).on("drag",t));m.append("rect").attr("height",function(e){return e.dy}).attr("width",d.nodeWidth()).style("display",function(e,t){return 2==e.name.length?"none":"block"}).style("fill",function(e){return e.color=i(e.name.substring(0,e.name.length-2))}).style("stroke",function(e){return d3.rgb(e.color).darker(2)}).append("title").text(function(e){return e.name+"\n"+s(e.value)}),m.append("text").attr("x",-6).attr("y",function(e){return e.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(e){return e.name.substring(0,e.name.length-2)}).filter(function(e){return e.x<l/2}).attr("x",6+d.nodeWidth()).attr("text-anchor","start")},e.refreshsankey=function(){e.createData_new()}}]),angular.module("app").controller("sankeyMedController",["$scope","Data","SPMedicationSharedDataService","$interval","$location","$rootScope",function(e,t,a,n,l,o){function r(e){var t;switch(typeof e){case"undefined":break;case"string":t=e+"";break;case"number":t=e-0;break;case"boolean":t=e;break;case"object":if(null===e)t=null;else if(e instanceof Array){t=[];for(var a=0,n=e.length;a<n;a++)t.push(r(e[a]))}else{t={};for(var l in e)t[l]=r(e[l])}break;default:t=e}return t}e.cohortslist={model:"1",lists:[]},e.patients=5,e.patterns=2,e.indexs=0,e.eventsByID_cpy={},e.eventsByID={},e.sandata={},e.frequency=[],e.$on("STARTRENDER",function(t,a){e.drawSankey()}),e.drawSankey=function(){var t=a.getData();e.sandata=t.sankeyData;for(var n={ChronicObstructivePulmonaryDis:"慢性阻塞性肺病",Heart_failure:"心力衰竭",Obesity:"肥胖症",PulmonaryDis:"肺病",KidneyDis:"肾病",Diabetes:"糖尿病"},l=0;l<e.sandata.length;l++){var o={};o.id=e.sandata[l].CohortIdx,o.name=n[e.sandata[l].CohortName],e.cohortslist.lists.push(o);for(var r=e.sandata[l].Similarities,s=0;s<r.length;s++){var i=r[s].Sequences;r[s].Sequences=d3.nest().key(function(e){return e.DD}).sortKeys(d3.ascending).entries(i)}}e.dealSankeyData()},e.dealSankeyData=function(){e.eventsByID=r(e.sandata[0].Similarities),e.eventsByID_cpy=r(e.sandata[0].Similarities),e.createData_new()},e.createData_new=function(){$("#chart_sankeys_med svg g").html("");for(var t=e.eventsByID,a=e.patterns,n=[],l=0,o=e.patients;l<o&&l<t.length;l++){for(var r=t[l].RefTime,s=0,i=0,c=t[l].Sequences.length-1;i<c;i++)t[l].Sequences[i].key==r&&(s=i);for(var i=0,c=2*a;i<c;i++){var d=s+i;if(d>t[l].Sequences.length-1)n.push({source:"_"+i,target:"_"+(i+1),value:1});else if(d==t[l].Sequences.length-1)for(var u=t[l].Sequences[d].values,g=0,p=u.length;g<p;g++)n.push({source:u[g].NAMECN+"_"+i,target:"_"+(i+1),value:1});else for(var u=t[l].Sequences[d].values,m=t[l].Sequences[d+1].values,g=0,p=u.length;g<p;g++)for(var h=0,f=m.length;h<f;h++)void 0!=u[g].NAMECN&&void 0!=m[h].NAMECN&&n.push({source:u[g].NAMECN+"_"+i,target:m[h].NAMECN+"_"+(i+1),value:1})}}e.createSankey(n)},e.createSankey=function(e){function t(e){d3.select(this).attr("transform","translate("+e.x+","+(e.y=Math.max(0,Math.min(o-e.dy,d3.event.y)))+")"),d.relayout(),p.attr("d",u)}var a="Widgets",n={top:10,right:20,bottom:10,left:10},l=$("#chart_sankeys_med").width()-n.left-n.right,o=1e3-n.top-n.bottom,r=d3.format(",.0f"),s=function(e){return r(e)+" "+a},i=d3.scale.category20();$("#chart_sankeys_med").html("");var c=d3.select("#chart_sankeys_med").append("svg").attr("width",l+n.left+n.right).attr("height",o+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),d=d3.sankey().nodeWidth(36).nodePadding(40).width(.9*$("#chart_sankeys_med").width()).size([l,o]),u=d.link(),g={nodes:[],links:[]};e.forEach(function(e){g.nodes.push({name:e.source}),g.nodes.push({name:e.target}),g.links.push({source:e.source,target:e.target,value:e.value})}),g.nodes=d3.keys(d3.nest().key(function(e){return e.name}).map(g.nodes)),g.links.forEach(function(e,t){g.links[t].source=g.nodes.indexOf(g.links[t].source),g.links[t].target=g.nodes.indexOf(g.links[t].target)}),g.nodes.forEach(function(e,t){g.nodes[t]={name:e}}),d.nodes(g.nodes).links(g.links).layout(32);var p=c.append("g").selectAll(".link").data(g.links).enter().append("path").attr("class","link").attr("d",u).style("stroke-width",function(e){return Math.max(1,e.dy)}).style("display",function(e,t){return 2==e.source.name.length||2==e.target.name.length?"none":"block"}).style("stroke","#000").style("stroke-opacity",.2).sort(function(e,t){return t.dy-e.dy});p.append("title").text(function(e){return e.source.name+" → "+e.target.name+"\n"+s(e.value)});var m=c.append("g").selectAll(".node").data(g.nodes).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).call(d3.behavior.drag().origin(function(e){return e}).on("dragstart",function(){this.parentNode.appendChild(this)}).on("drag",t));m.append("rect").attr("height",function(e){return e.dy}).attr("width",d.nodeWidth()).style("display",function(e,t){return 2==e.name.length?"none":"block"}).style("fill",function(e){return e.color=i(e.name.substring(0,e.name.length-2))}).style("stroke",function(e){return d3.rgb(e.color).darker(2)}).append("title").text(function(e){return e.name+"\n"+s(e.value)}),m.append("text").attr("x",-6).attr("y",function(e){return e.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(e){return e.name.substring(0,e.name.length-2)}).filter(function(e){return e.x<l/2}).attr("x",6+d.nodeWidth()).attr("text-anchor","start")},e.refreshsankey=function(){e.createData_new()}}]),angular.module("app").controller("SimilarPatientsDiaStatisticsController",SimilarPatientsDiaStatisticsController),angular.module("app").controller("SimilarPatientsMedStatisticsController",SimilarPatientsMedStatisticsController),angular.module("app").controller("SPDiagnosisCtrl",SPDiagnosisCtrl),angular.module("app").controller("SPMedicationCtrl",SPMedicationCtrl),angular.module("app").controller("tableTestController",["$scope","$document","$sce","medicalKnowledgeModal",function(e,t,a,n){var l=e.vm={};e.gridMouseover=function(t){e.$emit("nodeMouseover",t)},e.gridMouseleave=function(t){e.$emit("nodeMouseleave",t)},e.gridMouseClick=function(t,a){event.ctrlKey?"disease"!==a&&"medicine"!==a&&"symptom"!==a&&"lab"!==a||e.$emit("submitQuery",t):("medicine"===a&&(a="Medication"),n.generateModal(),n.triggerModal(a,t))},e.$on("graphElements",function(e,t){l.items=[];for(var a=0;a<t.nodes.length;a++){var n=t.nodes[a].data;l.items.push({id:n.id,name:n.name,type:n.type})}}),e.$on("nodeHovered",function(e,t){$("#"+t).addClass("my-table-hovered");var a=angular.element(document.getElementById(t));$("#myDetailsTable").scrollToElementAnimated(a,300)}),e.$on("nodeNotHovered",function(e,t){$("#"+t).removeClass("my-table-hovered")}),l.page={size:1e3,index:1},l.sort={column:"id",direction:-1,toggle:function(e){"name"!==e.name&&e.sortable!==!1&&(this.column===e.name?this.direction=-this.direction||-1:(this.column=e.name,this.direction=-1))}},l.columns=[{label:"ID",name:"id",type:"string"},{label:"名字",name:"name",type:"string"},{label:"类型",name:"type",type:"string"}]}]),angular.module("app").controller("treeViewCtrl",["$scope","$timeout","IntegralUITreeViewService","Data",function(e,t,a,n){e.treeName="treeSample",e.checkStates=["checked","unchecked"],e.currentState="checked",e.checkList=[],e.items=[],e.checkBoxSettings={autoCheck:!0,threeState:!0},e.$on("getHierarchyJson",function(t,a){var n=a,l=[];for(var o in n)if("LAB"!=o){var r={},s=n[o],i=[];for(var c in s){var d={},u=s[c],g=[];for(var p in u){var m={};m.id=u[p],m.text=u[p],m.pid=c,m.checkState="checked",m.type="item",m.icon="icons-medium",m.expanded=!1,m.level=3,g.push(m)}d.items=g,d.id=c,d.text=c,d.pid=o,d.type="item",d.icon="icons-medium",d.checkState="checked",d.expanded=!1,d.level=2,i.push(d)}r.id=o,r.text=o,r.items=i,r.icon="icons-medium",r.type="item",r.level=1,r.checkState="checked",l.push(r)}e.drawTree_list(l)}),e.drawTree_list=function(t){e.items=t,a.clearItems(e.treeName),a.loadData(e.treeName,t,"","",!0)},e.itemCheckStateChanging=function(t){"unchecked"==t.value&&(t.item.checkState="checked"),e.$emit("TreeDataChange",t)}}]),function(){function e(e,t,a,n){function l(){function a(e,t){var a=e.split("/"),n=t.split("/"),l=new Date;l.setUTCFullYear(a[0],a[1]-1,a[2]);var o=new Date;o.setUTCFullYear(n[0],n[1]-1,n[2]);for(var r=l.getTime(),s=o.getTime(),i=[],c=r;c<=s;)c!==r&&c!==s&&i.push(new Date(parseInt(c)).format()),c+=864e5;return i}function n(e,t){var a=e.split("/"),n=new Date;n.setUTCFullYear(a[0],a[1]-1,a[2]);var l=n.getTime()+864e5*t,o=new Date(parseInt(l)).format();return o}function l(){function t(){var e=$("#clinicPath svg");0!==e.length&&e.remove();var t=$("#cpLegend svg");0!==t.length&&t.remove(),i.createPath(f)}var l=o.special_date,s=l.in_date,g=l.operation_date,p=l.out_date,m=[];m[0]=[s],m[1]=a(s,n(g,-1)),m[2]=[n(g,-1)],m[3]=[g],m[4]=a(g,p),m[5]=[p];for(var h,f={nodes:[{phase:0,sphase:[{sphase:0,tphase:[]}]},{phase:1,sphase:[{sphase:0,tphase:[]}]},{phase:2,sphase:[{sphase:0,tphase:[]}]},{phase:3,sphase:[{sphase:0,tphase:[]}]},{phase:4,sphase:[{sphase:0,tphase:[]}]},{phase:5,sphase:[{sphase:0,tphase:[]}]}]},v=-1,b=-1,y=1e3,C=-1,S=1e3,k=0,x=m.length;k<x;k++){for(var w=[],D=[],I=0,P=m[k].length;I<P;I++){var N=m[k][I],R=o.normal_date[N];if(void 0!==R)for(var A=0,T=R.length;A<T;A++)w.indexOf(R[A])===-1?(w.push(R[A]),D.push(1)):D[w.indexOf(R[A])]++}var M=f.nodes[k].sphase[0].tphase,_=[];for(A=0,T=w.length;A<T;A++){var L=w[A],E={code:L,count:D[A],node:r[L].item_name,cost:r[L].item_fee,score:r[L].score,reason:r[L].reason};E.value=E.cost*E.count,""!==E.score?E.target=3:(E.target=2,E.value=c[k],E.score=.527959927140255,_.push(L)),E.score>C&&(C=E.score),E.score<S&&(S=E.score),E.value>b&&(b=E.value),E.value<y&&(y=E.value),M.push(E)}for(var F=M,O=0,B=F.length;O<B;O++)2===F[O].target&&d[k].indexOf(F[O].code)===-1&&(F[O].target=3);for(A=0,T=d[k].length;A<T;A++)if(_.indexOf(d[k][A])===-1){L=d[k][A];var U={code:L,node:u[k][A],target:1,value:c[k],score:.527959927140255};M.push(U)}v<M.length&&(v=M.length),M.sort(function(e,t){return e.target===t.target?e.score>t.score?1:-1:t.target-e.target})}h=x,f.xNodesNum=h,f.yNodesNum=v,f.valMax=b,f.valMin=y,f.scoreMax=C,f.scoreMin=S,void 0,e(t,200)}s.isLoading=!0,t.$apply();var o,r,c=[132.04928571428573,190.78868421052624,144.86387096774192,142.4047619047619,532.5679411764705,736.4989255018023],d=[["F00000003702","F00000008313","F00000144169","F00000002992","F00000003633","F00000056668","F00000056670","F00000056568","F00000003634","F00000008157","F00000001600","F00000083368","F00000001063","F00000001062","F00000008139","F00000108168","F00000008137","F00000008336","F00000008196","F00000008243"],["F00000001063","Y00000001225","Y00000011459","Y00000034756","Y00000002592"],["Y00000011359","F00000006578","Y00000003595"],["F00000001600","F00000056670","F00000056568","F00000006358","F00000108172","Y00000002592","F00000144169","Y00000001225","Y00000003595","F00000001061","F00000001062","Y00000011359","F00000001082","F00000001083"],["Y00000003595","F00000001118","F00000001062","F00000001063","F00000056670","Y00000001274","F00000144169","F00000008195","F00000001600","F00000056668"],[]],u=[["十二通道心电图检查","心动超声[复]","肝功十四项[复]","卡式血型鉴定","肺通气功能检查","肾功五项[复]","电解质六项[复]","凝血六项[复]","肺弥散功能检查","传染性指标检测八项(常规)[复]","血细胞分析+五分类","肿瘤标志物胃肠癌检测[复]","二级护理","一级护理","粪常规[复]","传染性指标检测八项(急诊)[复]","尿常规(分析+尿沉渣定量)[复]","电子胃镜常规检查[复]","正、侧位[复]","多层CT平扫（每部位）[复]"],["二级护理","0.9%氯化钠(袋)","转化糖电解质（田力）","庆大霉素","氨溴索(兰苏)"],["头孢替安（佩罗欣）","红细胞2u","头孢呋辛钠(西力欣)"],["血细胞分析+五分类","电解质六项[复]","凝血六项[复]","气压治疗","肾功六项[复]","氨溴索(兰苏)","肝功十四项[复]","0.9%氯化钠(袋)","头孢呋辛钠(西力欣)","特级护理","一级护理","头孢替安（佩罗欣）","加压给氧","持续吸氧"],["头孢呋辛钠(西力欣)","特大换药","一级护理","二级护理","电解质六项[复]","复方泛影葡胺(#B)","肝功十四项[复]","正位片[复]","血细胞分析+五分类","肾功五项[复]"],[]];Date.prototype.format=function(){var e="";return e+=this.getFullYear()+"/",e+=this.getMonth()+1+"/",
e+=this.getDate()};var g=$.ajax({url:'http://59.110.52.133:3010/api/transfer?q={"path":"/clinicalpath/queryItemsTime","params":{"PID":"'+i.patientInfo.ID+'"}}',success:function(e){void 0,void 0,void 0,o=e}}),p=$.ajax({url:'http://59.110.52.133:3010/api/transfer?q={"path":"/clinicalpath/queryItem","params":{"PID":"'+i.patientInfo.ID+'"}}',success:function(e){void 0,void 0,r=e.Items}});Promise.all([g,p]).then(function(e){void 0,s.isLoading=!1,t.$apply(),o=e[0],r=e[1].Items,l()})}function o(e,t){return function(a){return e*(1-a)+t*a}}function r(e,t,a,n,l,r,s,i,c){1===i&&(e.push(e[e.length-1]),t.push(t[l[l.length-1]]),a.push(a[l[l.length-1]]),l.push(e.length-1));for(var d,u,g=e.length,p=e[0],m=e[1],h=o(p,m),f=.5,v=t[n[0]]-a[n[0]],b=t[n[1]]-a[n[1]],y="M"+r.left+","+v+" L"+p+","+v,C=n.length,S=l.length,k=0;k<C-1;k++)d=n[k],u=n[k+1],p=e[d],m=e[u],h=o(p,m),v=t[d]-a[d],b=t[u]-a[u],y+="C"+h(f)+","+v+" "+h(1-f)+","+b+" "+m+","+b;for(void 0,void 0,y+="L"+(e[n[C-1]]+c)+","+(t[n[C-1]]-a[n[C-1]])+"L"+(e[n[C-1]]+c)+","+(t[l[S-1]]+a[l[S-1]])+"L"+e[g-1]+","+(t[l[S-1]]+a[l[S-1]]),k=S-1;k>0;k--)void 0,d=l[k],u=l[k-1],p=e[d],m=e[u],h=o(p,m),v=t[d]+a[d],b=t[u]+a[u],y+="C"+h(f)+","+v+" "+h(1-f)+","+b+" "+m+","+b;return y+="L"+r.left+","+(t[l[0]]+a[l[0]])}var s=t.vm={};s.title="ControllerName",$("#cfGraphs").height(.9*screen.height-210),$("#patientsOverview").height(.9*screen.height-210);var i={};({width:$("#simplewizard-steps").width(),height:600});$.get("data/queryRawStat.json").success(function(e){var t=e.content;void 0,i.createCrossfiterGraphs(t)}),i.createCrossfiterGraphs=function(e){function t(e){for(var t=0,a=arguments.length;t<a;t++)arguments[t].filterAll();dc.redrawAll()}var a=.3*$("#simplewizard-steps").width()-37,n=.618*a;void 0;var l=[],o={};for(var r in e)if(e.hasOwnProperty(r)){var c=e[r];c.ID=r,c.Age<26?c.AgeRange="0~25":c.Age<46?c.AgeRange="26~45":c.Age<61?c.AgeRange="46~60":c.Age<71?c.AgeRange="61~70":c.AgeRange="70~",0===c.Pathway_on?c.Pathway_on="否":c.Pathway_on="是",l.push(c)}void 0;var d=crossfilter(l);o.dim={gender:d.dimension(function(e){return e.Gender}),age:d.dimension(function(e){return e.Age}),ageRange:d.dimension(function(e){return e.AgeRange}),stayDays:d.dimension(function(e){return e.Stay_days}),score:d.dimension(function(e){return e.Score}),isOnPathway:d.dimension(function(e){return e.Pathway_on}),cost:d.dimension(function(e){return[e.Cost,1]})},void 0;var u=o.dim.isOnPathway.group().reduceCount(function(e){}),g=o.dim.gender.group().reduceCount(),p=o.dim.ageRange.group().reduceCount(),m=o.dim.stayDays.group().reduceCount(function(e){}),h=o.dim.ageRange.group().reduce(function(e,t){return e[t.Pathway_on]=(e[t.Pathway_on]||0)+1,e},function(e,t){return e[t.Pathway_on]=(e[t.Pathway_on]||0)-1,e},function(){return{}}),f=o.dim.cost.group();void 0;var v=dc.barChart("#cfPathwayBar"),b=dc.barChart("#cfGenderBar"),y=dc.barChart("#cfAgeRangBar"),C=dc.barChart("#cfStayLengthBar"),S=dc.scatterPlot("#cfCostBar");v.margins().left=60,b.margins().left=60,y.margins().left=60,C.margins().left=60,S.margins().left=60,v.width(a).height(n).x(d3.scale.ordinal()).xUnits(dc.units.ordinal).xAxisLabel("是否在标准临床路径中").dimension(o.dim.isOnPathway).group(u).elasticX(!0).controlsUseVisibility(!0).on("preRedraw",function(e){i.createOverview(o.dim.score.top(30))}),b.width(a).height(n).x(d3.scale.ordinal()).xUnits(dc.units.ordinal).xAxisLabel("性别").dimension(o.dim.gender).group(g).elasticY(!0).controlsUseVisibility(!0),y.width(a).height(n).x(d3.scale.ordinal()).xUnits(dc.units.ordinal).xAxisLabel("年龄段").dimension(o.dim.ageRange).group(p).elasticY(!0).controlsUseVisibility(!0),C.width(a).height(n).x(d3.scale.linear().domain([1,52])).xAxisLabel("在院时间（天）").dimension(o.dim.stayDays).group(m).elasticY(!0).controlsUseVisibility(!0),S.width(a).height(n).x(d3.scale.linear().domain([0,2e5])).y(d3.scale.linear().domain([0,2])).dimension(o.dim.cost).excludedColor("#ddd").group(f).xAxisLabel("费用(元)").controlsUseVisibility(!0).on("postRender",function(){$("#cfCostBar svg").css("height",n+30),$("#cfCostBar .x-axis-label").css("transform","matrix(1, 0, 0, 1, "+a/2+", "+(n+15)+")"),void 0}),dc.renderAll(),s.reset={all:function(){t(C,v,y,b,S)}},i.createOverview(o.dim.score.top(9999))},$("#nextButton").bind("click",l),i.createOverview=function(e){var t=$("#patientsOverview svg");void 0,t.length>0&&d3.select("#patientsOverview svg").remove(),a.pageLoading=!1,void 0;var n=.7*$("#simplewizard-steps").width()-37,l={top:5,bottom:5,left:25,right:25},o=e.length;void 0;var r=30*o;i.svgWidth=n/.7,i.patientInfo=e[0];var s=e.slice(0,o);i.patientInfo=s[0],void 0;var c=s[o-1].Score,d=s[0].Score,u=d3.select("#patientsOverview").append("svg").attr("width",n).attr("height",r).append("g").attr("transform","translate("+l.left+","+l.top+")"),g=.15*n,p=d3.scale.linear().range([0,n-g-50]).domain([c-1,d]),m=d3.scale.ordinal().rangeRoundBands([-8,r],.2).domain(s.map(function(e){return e.ID})),h=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<p><strong>ID:</strong>&nbsp&nbsp"+e.ID+"</p><p><strong>姓名:</strong>&nbsp&nbsp "+e.Name+"</p><p><strong>性别:</strong>&nbsp&nbsp "+e.Gender+"</p><p><strong>年龄:</strong>&nbsp&nbsp "+e.Age+"岁</p><p><strong>费用:</strong>&nbsp&nbsp "+e.Cost+"元</p>"});u.call(h);u.selectAll().data(s).enter().append("rect").attr("class","bar").attr("y",function(e){return m(e.ID)}).attr("height",m.rangeBand()).attr("x",function(e){return g-10}).on("mouseover",h.show).on("mouseover.test2",function(e){d3.select(this).style("fill","red")}).on("mouseout",function(e){h.hide(),d3.selectAll("#patientsOverview rect").filter(function(t){return t.ID===e.ID}).style("fill","steelblue")}).on("click",function(e){i.patientInfo=e,$("#nextButton").trigger("click")}).attr("width",function(e){return p(e.Score)}).style({opacity:1,color:"steelblue",cursor:"pointer"}).attr("fill","steelblue");u.selectAll().data(s).enter().append("text").attr("class","featuretext").attr("text-anchor","right").on("mouseover",h.show).on("mouseout",h.hide).style("opacity",1).attr("x",function(e){return g-100}).attr("y",function(e){return m(e.ID)}).attr("dy",15).attr("dx",4).text(function(e){return e.Name}),u.selectAll().data(s).enter().append("text").attr("class","featuretext").attr("text-anchor","right").on("mouseover",h.show).on("mouseout",h.hide).style("opacity",1).attr("x",function(e){return p(e.Score)+g-10}).attr("y",function(e){return m(e.ID)}).attr("dy",15).attr("dx",4).text(function(e){return e.Score.toFixed(2)})},i.legend={shortR:-1,longR:-1,deepColor:"",lightColor:"",midColor:"",normalScore:.51,maxScore:-1,minCost:-1,maxCost:-1},i.createPath=function(e){function t(){var e=r(d,u,g,I,P,n,o,0,c),t=r(d,u,g,N,R,n,o,i.isLackOfSixPhase,c);W.append("path").attr("d",e).attr("class","personalLink"),W.append("path").attr("d",t).attr("class","standardLink")}function a(){void 0,window.zoomTiger=svgPanZoom("#clinicPath svg",{zoomEnabled:!0,controlIconsEnabled:!1,fit:!0,center:!0,width:o,height:s})}$("#patientInfo").html("<p style='padding-top: 30px'> &nbsp姓名:&nbsp"+i.patientInfo.Name+";&nbsp&nbsp&nbsp总得分:&nbsp  "+i.patientInfo.Score.toFixed(2)+"</p>");var n={left:40,right:40,top:20,bottom:20},l=[],o=i.svgWidth-n.left,s=600-n.top-n.bottom,c=o/(e.xNodesNum+1),d=(s/(e.yNodesNum+1),[]),u=[],g=[],p=20,m=1,h=e.valMax,f=e.valMin,v=e.scoreMax,b=e.scoreMin,y=[],C=e.nodes,S=C.length,k=0,x=0,w=[],D=0,I=[],P=[],N=[],R=[],A=0;i.legend.minCost=f,i.legend.minScore=b,i.legend.maxCost=h,i.legend.maxScore=v,void 0,i.isLackOfSixPhase=1,i.legend.shortR=p-(p-m)*(v-.51)/(v-b),i.legend.longR=p,void 0;for(var T=-1,M=0;M<S;M++)for(var _=C[M].sphase.length,L=C[M].sphase,E=0;E<_;E++){k+=c;var F=L[E].tphase.length,O=L[E].tphase;x=0;for(var B=0,U=0;U<F;U++)D=p-(p-m)*(v-O[U].score)/(v-b),B+=D,U===F-1&&(w.push(s/2-B),void 0,2.2*B>T&&(T=2.2*B),M===S-1&&T>s&&(c=T*o/s/(e.xNodesNum+1),void 0))}for(k=0,M=0;M<S;M++){var q=C[M].sphase.length,z=C[M].sphase;for(E=0;E<q;E++){k+=c;var j=z[E].tphase.length,G=z[E].tphase;x=0;var Y=0;for(U=0;U<j;U++)D=p-(p-m)*(v-G[U].score)/(v-b),Y+=D,U===j-1&&w.push(s/2-Y);for(U=0;U<j;U++){M===S-1&&3!==G[U].target&&(i.isLackOfSixPhase=0),D=p-(p-m)*(v-G[U].score)/(v-b),x+=1.1*D;var H=x+w[M];u.push(H),x+=1.1*D,0===U?2===G[U].target?(I.push(A),N.push(A)):3===G[U].target?I.push(A):1===G[U].target&&N.push(A):U===j-1&&(2===G[U].target?(P.push(A),R.push(A)):3===G[U].target?P.push(A):1===G[U].target&&R.push(A)),(2===G[U].target||3===G[U].target)&&U<j-1&&1===G[U+1].target&&P.push(A),3===G[U].target&&U<j-1&&(1===G[U+1].target||2===G[U+1].target)&&N.push(A+1);var Z=G[U];Z.x=k,Z.y=H,Z.r=D,l.push(Z),d.push(k),g.push(D),y.push(G[U].type),A++}}}void 0;var K=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<strong>名称:</strong> <span style='color:red'>"+e.node+"</span>"}),W=d3.select("#clinicPath").append("svg").attr("width",o+n.left+n.right).attr("height",s+n.top+n.bottom);i.legend.pathSvgWidth=o+n.left+n.right,i.legend.pathSvgHeight=s+n.top+n.bottom,W.call(K);d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("cardinal");t();var J=d3.rgb(70,130,180),Q=d3.rgb(84,138,84),V=d3.rgb(255,0,0),X=d3.rgb(0,0,255),ee=d3.rgb(0,255,0),te=d3.rgb(255,255,255),ae=d3.scale.linear().domain([f,h]).range([.5,1]),ne=(d3.interpolate(J,X),d3.interpolate(Q,ee),d3.interpolate(te,V));i.legend.deepColor=ne(ae(h)),i.legend.lightColor=ne(ae(f)),i.legend.midColor=ne(ae((h+f)/2));var le=W.selectAll().data(l).enter().append("circle").style("fill",function(e){return!e.score&&e.target<3&&(e.score=0),ne(ae(e.value))}).style("cursor","pointer").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",function(e){return e.r}).on("mouseover",K.show).on("mouseover.test",function(e){le.filter(function(t){return t.node===e.node}).style("stroke","black").style("stroke-width",2),$("#showReason").html("<p> 名称 :"+e.node+"   得分: "+e.score.toFixed(2)+"</p><p> 原因 :"+e.reason+"</p>")}).on("mouseout",function(e){K.hide(),le.filter(function(t){return t.node===e.node}).style("stroke-width",0),$("#showReason").html("")});a(),i.legend.create()},i.legend.create=function(){void 0;var e=d3.select("#cpLegend").append("svg").attr("width",540).attr("height",75).attr("style","position: relative;left: "+(i.legend.pathSvgWidth-540)+"px;top: 0px;outline: 1px solid steelblue;"),t={left:10,top:-10,right:10,bottom:10},a={width:60,height:15},n=[{x:t.left+10,y:t.top+20,dx:a.width,dy:a.height,color:"rgb(0,255,0)",opacity:.2},{x:t.left+10,y:t.top+40,dx:a.width,dy:a.height,color:"rgb(159,201,215)",opacity:1},{x:t.left+10,y:t.top+60,dx:a.width,dy:a.height,color:"rgb(0,0,255)",opacity:.2}],l=[{x:n[0].x+a.width+10,y:n[0].y+12,content:"个人路径"},{x:n[1].x+a.width+10,y:n[1].y+12,content:"重叠部分"},{x:n[2].x+a.width+10,y:n[2].y+12,content:"标准路径"}],o=l[1].y-20,r=[{x:l[0].x+100,r:i.legend.shortR,color:i.legend.lightColor},{x:l[0].x+150,r:(i.legend.shortR+i.legend.longR)/2,color:i.legend.lightColor},{x:l[0].x+200,r:i.legend.longR,color:i.legend.lightColor},{x:l[0].x+280,r:(i.legend.shortR+i.legend.longR)/2,color:i.legend.lightColor},{x:l[0].x+330,r:(i.legend.shortR+i.legend.longR)/2,color:i.legend.midColor},{x:l[0].x+380,r:(i.legend.shortR+i.legend.longR)/2,color:i.legend.deepColor}],s=o+r[2].r+5,c=4,d=[{x1:r[0].x,y1:s,x2:r[2].x,y2:s,isXAxis:1},{x1:r[3].x,y1:s,x2:r[5].x,y2:s,isXAxis:1},{x1:r[0].x,y1:s,x2:r[0].x,y2:s-c},{x1:r[1].x,y1:s,x2:r[1].x,y2:s-c},{x1:r[2].x,y1:s,x2:r[2].x,y2:s-c},{x1:r[3].x,y1:s,x2:r[3].x,y2:s-c},{x1:r[4].x,y1:s,x2:r[4].x,y2:s-c},{x1:r[5].x,y1:s,x2:r[5].x,y2:s-c}];void 0,void 0,void 0,l.push({x:r[0].x-10,y:s+13,content:i.legend.normalScore.toFixed(1)},{x:r[1].x-10,y:s+13,content:((i.legend.normalScore+i.legend.maxScore)/2).toFixed(1)},{x:r[2].x-10,y:s+13,content:i.legend.maxScore.toFixed(1)},{x:r[3].x-10,y:s+13,content:i.legend.minCost.toFixed(1)},{x:r[4].x-15,y:s+13,content:(i.legend.minScore+i.legend.maxCost).toFixed(1)},{x:r[5].x-5,y:s+13,content:i.legend.maxCost.toFixed(1)},{x:r[2].x+20,y:s,content:"得分"},{x:r[5].x+20,y:s,content:"花费(元)"});var u=e.append("defs"),g=u.append("marker").attr("id","arrow").attr("markerUnits","strokeWidth").attr("markerWidth","12").attr("markerHeight","12").attr("viewBox","0 0 12 12").attr("refX","10").attr("refY","6").attr("orient","auto"),p="M2,2 L10,6 L2,10 L6,6 L2,2";g.append("path").attr("d",p).attr("fill","#000"),e.selectAll().data(d).enter().append("line").attr("x1",function(e){return e.x1}).attr("y1",function(e){return e.y1}).attr("x2",function(e){return e.x2}).attr("y2",function(e){return e.y2}).style({"stroke-width":1,stroke:"black"}).attr("marker-end",function(e){if(e.isXAxis)return"url(#arrow)"}),e.selectAll().data(n).enter().append("rect").attr("x",t.left).attr("y",function(e){return e.y}).attr("width",function(e){return e.dx}).attr("height",function(e){return e.dy}).attr("fill",function(e){return e.color}).style("opacity",function(e){return e.opacity}),e.selectAll().data(l).enter().append("text").attr("x",function(e){return e.x}).attr("y",function(e){return e.y}).text(function(e){return e.content}),e.selectAll().data(r).enter().append("circle").attr("cy",o).attr("cx",function(e){return e.x}).attr("r",function(e){return e.r}).attr("fill",function(e){return e.color})}}e.$inject=["$timeout","$scope","$rootScope","$location"],angular.module("app").controller("CPcomparisonController",e)}(),function(){function e(e,t,a,n){var l=e.vm={};n.get('http://59.110.52.133:3010/api/transfer/?q={"path":"/medcareFee/getUserItems","params":{%22PID%22:%22ZY010001102284%22}}').success(function(e){void 0,e=e.Patient;var a=[];for(var n in e.Items)e.Items.hasOwnProperty(n)&&(e.Items[n].id=n,"Automatically approved"===e.Items[n].state?e.Items[n].stateClass="itemApproved":"Accepted"===e.Items[n].state?e.Items[n].stateClass="itemAccepted":"Pending"===e.Items[n].state?e.Items[n].stateClass="itemPending":"Rejected"===e.Items[n].state&&(e.Items[n].stateClass="itemRejected"),a.push(e.Items[n]));a.sort(function(e,t){return e.score<t.score?1:-1}),void 0,l.allMem=a,t.pageLoading=!1}),l.isStateDic=["否","是"],l.columns=[{label:"ID",name:"id"},{label:"名称",name:"item_name"},{label:"费用(元)",name:"item_fee"},{label:"得分",name:"score"},{label:"状态",name:"state"},{label:"原因",name:"reason"},{label:"备注",name:"comment"}],l.itemStates=[{stateName:"Accepted",code:"accepted"},{stateName:"Rejected",code:"rejected"}],l.cancel=function(){},l.sort={column:"score",direction:-1,toggle:function(e){e.sortable!==!1&&(this.column===e.name?this.direction=-this.direction||-1:(this.column=e.name,this.direction=-1))}},l.page={size:10,index:1},l.comfirmedIds=[],l.stateChangeDisable=!1,l.confirm=function(e){l.comfirmedIds.indexOf(e)===-1&&l.comfirmedIds.push(e);var t={PID:"ZY010001102284",IID:l.details.id,Status:l.details.state,Comment:l.details.comment};t.Status=l.isAccepted===!0?"accepted":"rejected",l.details.state=l.isAccepted===!0?"Accepted":"Rejected",l.details.stateClass=l.isAccepted===!0?"itemAccepted":"itemRejected",$.ajax({url:"http://59.110.52.133:9999/medcareFee/updateUserItems/",type:"POST",data:JSON.stringify(t),success:function(e){void 0,void 0}})},l.getDetails=function(e){l.comfirmedIds.indexOf(e)>-1?l.stateChangeDisable=!0:l.stateChangeDisable=!1,l.stateCodeValue=null;for(var t=0,a=l.allMem.length;t<a;t++)l.allMem[t].id===e&&(l.details=l.allMem[t]);$("#itemDetails").modal("show")},l.isAccepted=!0,l.toggleIsAccepted=function(){l.isAccepted=!l.isAccepted}}e.$inject=["$scope","$rootScope","$location","$http"],angular.module("app").controller("MedcareFeeController",e)}(),angular.module("app").controller("traditionalSearchController",["traMedical","medicalKnowledgeModal","$scope","$rootScope","$state",function(e,t,a,n,l,o){function r(e){return"overview"==e?"概述":e}void 0,a.name="中药检索",a.medicalTree={},a.traSearchTree={},a.vm={},n.pageLoading=!0,e.getAllList().then(function(e){n.pageLoading=!1,a.medicalTree=e.Results.Main,a.traSearchTree=a.medicalTree["中药检索"],void 0}),a.class1="中药检索",a.class3="清热",a.class2="常用方剂",a.class4="",a.vm={},a.vm.items=[],a.vm.columns=[{label:"名称"},{label:"一级类别"},{label:"二级类别"},{label:"三级类别"}],a.vm.pageSize=15,a.vm.pageNumber=0,a.vm.totalNumber=0,a.vm.pp=1,a.vm.pageList=[{label:"首页",diaplay:"disabled"},{label:"上一页",diaplay:"disabled"},{label:"下一页",diaplay:"disabled"},{label:"末页",diaplay:"disabled"}],a.gridMouseClick=function(t){e.getDetails(t).then(function(e){n.pageLoading=!1,a.datails=e.Results.Main,a.Name=e.Results.Name,$("#myModal").modal("show")})},a.showdetails=function(e,a){e&&a&&(void 0,t.generateModal(),t.triggerModal(e,a))},a.showlevel4=function(t,l,o,s,i){a.class2=l,a.class3=o,a.class4=s,a.vm.pageNumber=0,a.vm.pp=1,e.getZhongyilist(t,l,o,s,"",a.vm.pageSize,a.vm.pageNumber).then(function(e){if(void 0,n.pageLoading=!1,""!==e.Results&&void 0!==e.Results){a.vm.items=[],a.vm.totalNumber=e.Total_Zhongyi_Count,a.vm.pp=parseInt(a.vm.totalNumber/a.vm.pageSize-1e-5)+1;for(var t in e.Results){var l={};l.Zid=e.Results[t][0].Zid,l.Name=e.Results[t][1].Name,l.Class1=r(e.Results[t][2].Class1),l.Class2=r(e.Results[t][3].Class2),l.Class3=r(e.Results[t][4].Class3),l.Class4=r(e.Results[t][5].Class4),a.vm.items.push(l)}}else void 0},function(e){n.pageLoading=!1,void 0})},a.showlevel4(a.class1,a.class2,a.class3,a.class4,""),a.pages=function(t){0==t?a.vm.pageNumber=0:1==t?a.vm.pageNumber<=0?a.vm.pageNumber=0:a.vm.pageNumber=a.vm.pageNumber-1:2==t?a.vm.pageNumber>=parseInt(a.vm.totalNumber/a.vm.pageSize-.001)?a.vm.pageNumber=parseInt(a.vm.totalNumber/a.vm.pageSize-.001):a.vm.pageNumber=a.vm.pageNumber+1:3==t&&(a.vm.pageNumber=parseInt(a.vm.totalNumber/a.vm.pageSize)),e.getZhongyilist(a.class1,a.class2,a.class3,a.class4,"",a.vm.pageSize,a.vm.pageNumber).then(function(e){if(void 0,n.pageLoading=!1,""!==e.Results&&void 0!==e.Results){a.vm.items=[],a.vm.totalNumber=e.Total_Zhongyi_Count;for(var t in e.Results){var l={};l.Zid=e.Results[t][0].Zid,l.Name=e.Results[t][1].Name,l.Class1=r(e.Results[t][2].Class1),l.Class2=r(e.Results[t][3].Class2),l.Class3=r(e.Results[t][4].Class3),l.Class4=r(e.Results[t][5].Class4),a.vm.items.push(l)}}else void 0},function(e){n.pageLoading=!1,void 0})}}]),angular.module("app").controller("traditionalShiliaoController",["traMedical","medicalKnowledgeModal","$scope","$rootScope","$state",function(e,t,a,n,l,o){function r(e){return"overview"==e?"概述":e}void 0,void 0,a.name="药膳食疗",a.medicalTree={},a.traSearchTree={},a.vm={},n.pageLoading=!0,e.getAllList().then(function(e){n.pageLoading=!1,a.medicalTree=e.Results.Main,a.traSearchTree=a.medicalTree["药膳食疗"],void 0}),a.class1="药膳食疗",a.class2="治病常用药酒",a.class3="",a.class4="",a.vm={},a.vm.items=[],a.vm.columns=[{label:"名称"},{label:"一级类别"},{label:"二级类别"},{label:"三级类别"},{label:"四级类别"}],a.vm.pageSize=15,a.vm.pageNumber=0,a.vm.totalNumber=0,a.vm.pp=1,a.vm.pageList=[{label:"首页",diaplay:"disabled"},{label:"上一页",diaplay:"disabled"},{label:"下一页",diaplay:"disabled"},{label:"末页",diaplay:"disabled"}],a.gridMouseClick=function(t){e.getDetails(t).then(function(e){n.pageLoading=!1,a.datails=e.Results.Main,a.Name=e.Results.Name,$("#myModal").modal("show")})},a.showdetails=function(e,a){e&&a&&(void 0,t.generateModal(),t.triggerModal(e,a))},a.showlevel4=function(t,l,o,s,i){a.class2=l,a.class3=o,a.class4=s,a.vm.pageNumber=0,a.vm.pp=1,e.getZhongyilist(t,l,o,s,"",a.vm.pageSize,a.vm.pageNumber).then(function(e){if(void 0,n.pageLoading=!1,""!==e.Results&&void 0!==e.Results){a.vm.items=[],a.vm.totalNumber=e.Total_Zhongyi_Count,a.vm.pp=parseInt(a.vm.totalNumber/a.vm.pageSize)+1;for(var t in e.Results){var l={};l.Zid=e.Results[t][0].Zid,l.Name=e.Results[t][1].Name,l.Class1=r(e.Results[t][2].Class1),l.Class2=r(e.Results[t][3].Class2),l.Class3=r(e.Results[t][4].Class3),l.Class4=r(e.Results[t][5].Class4),a.vm.items.push(l)}}else void 0},function(e){n.pageLoading=!1,void 0})},a.showlevel4(a.class1,a.class2,a.class3,a.class4,""),a.pages=function(t){0==t?a.vm.pageNumber=0:1==t?a.vm.pageNumber<=0?a.vm.pageNumber=0:a.vm.pageNumber=a.vm.pageNumber-1:2==t?a.vm.pageNumber>=parseInt(a.vm.totalNumber/a.vm.pageSize)?a.vm.pageNumber=parseInt(a.vm.totalNumber/a.vm.pageSize):a.vm.pageNumber=a.vm.pageNumber+1:3==t&&(a.vm.pageNumber=parseInt(a.vm.totalNumber/a.vm.pageSize)),e.getZhongyilist(a.class1,a.class2,a.class3,a.class4,"",a.vm.pageSize,a.vm.pageNumber).then(function(e){if(void 0,n.pageLoading=!1,""!==e.Results&&void 0!==e.Results){a.vm.items=[],a.vm.totalNumber=e.Total_Zhongyi_Count;for(var t in e.Results){var l={};l.Zid=e.Results[t][0].Zid,l.Name=e.Results[t][1].Name,l.Class1=r(e.Results[t][2].Class1),l.Class2=r(e.Results[t][3].Class2),l.Class3=r(e.Results[t][4].Class3),l.Class4=r(e.Results[t][5].Class4),a.vm.items.push(l)}}else void 0},function(e){n.pageLoading=!1,void 0})}}]),angular.module("app").controller("traditionalSyndromeController",["$scope","$rootScope","traMedical","medicalKnowledgeModal","$state",function(e,t,a,n,l,o){function r(e){return"overview"==e?"概述":e}void 0,e.name="辨证论治",e.medicalTree={},e.traSearchTree={},t.pageLoading=!0,a.getAllList().then(function(a){t.pageLoading=!1,e.medicalTree=a.Results.Main,e.traSearchTree=e.medicalTree["辨证论治"]},function(e){t.pageLoading=!1,void 0}),e.vm={},e.class1="辨证论治",e.class2="中医妇科",e.class3="overview",e.class4="",e.tableData=[],e.vm.items=[],e.vm.columns=[{label:"名称"},{label:"一级类别"},{label:"二级类别"},{label:"三级类别"},{label:"四级类别"}],e.vm.pageSize=15,e.vm.pageNumber=0,e.vm.totalNumber=0,e.vm.pp=1,e.vm.pageList=[{label:"首页",diaplay:"disabled"},{label:"上一页",diaplay:"disabled"},{label:"下一页",diaplay:"disabled"},{label:"末页",diaplay:"disabled"}],e.showlevel4=function(n,l,o){e.class2=n,e.class3=l,e.class4=o,e.vm.pageNumber=0,e.vm.pp=1,a.getZhongyilist("辨证论治",n,l,o,"",e.vm.pageSize,e.vm.pageNumber).then(function(a){if(void 0,t.pageLoading=!1,""!==a.Results&&void 0!==a.Results){e.vm.items=[],e.vm.totalNumber=a.Total_Zhongyi_Count,e.vm.pp=parseInt(e.vm.totalNumber/e.vm.pageSize)+1;for(var n in a.Results){var l={};l.Zid=a.Results[n][0].Zid,l.Name=a.Results[n][1].Name,l.Class1=r(a.Results[n][2].Class1),l.Class2=r(a.Results[n][3].Class2),l.Class3=r(a.Results[n][4].Class3),l.Class4=r(a.Results[n][5].Class4),e.vm.items.push(l)}}else void 0},function(e){t.pageLoading=!1,void 0})},e.showlevel4(e.class2,e.class3,e.class4),e.pages=function(n){0==n?e.vm.pageNumber=0:1==n?e.vm.pageNumber<=0?e.vm.pageNumber=0:e.vm.pageNumber=e.vm.pageNumber-1:2==n?e.vm.pageNumber>=parseInt(e.vm.totalNumber/e.vm.pageSize)?e.vm.pageNumber=parseInt(e.vm.totalNumber/e.vm.pageSize):e.vm.pageNumber=e.vm.pageNumber+1:3==n&&(e.vm.pageNumber=parseInt(e.vm.totalNumber/e.vm.pageSize)),a.getZhongyilist("辨证论治",e.class2,e.class3,e.class4,"",e.vm.pageSize,e.vm.pageNumber).then(function(a){if(void 0,t.pageLoading=!1,""!==a.Results&&void 0!==a.Results){e.vm.items=[],e.vm.totalNumber=a.Total_Zhongyi_Count;for(var n in a.Results){var l={};l.Zid=a.Results[n][0].Zid,l.Name=a.Results[n][1].Name,l.Class1=r(a.Results[n][2].Class1),l.Class2=r(a.Results[n][3].Class2),l.Class3=r(a.Results[n][4].Class3),l.Class4=r(a.Results[n][5].Class4),e.vm.items.push(l)}}else void 0},function(e){t.pageLoading=!1,void 0})},e.showdetails=function(e,t){e&&t&&(void 0,n.generateModal(),n.triggerModal(e,t))},e.gridMouseClick=function(n){a.getDetails(n).then(function(a){t.pageLoading=!1,e.datails=a.Results.Main,void 0,e.Name=a.Results.Name,$("#myModal").modal("show")},function(e){t.pageLoading=!1,void 0})}}]),angular.module("app").controller("traditionalTuinanController",["traMedical","medicalKnowledgeModal","$scope","$rootScope","$state",function(e,t,a,n,l,o){function r(e){return"overview"==e?"概述":e}void 0,a.name="针灸推拿",a.medicalTree={},a.traSearchTree={},a.vm={},n.pageLoading=!0,e.getAllList().then(function(e){n.pageLoading=!1,a.medicalTree=e.Results.Main,a.traSearchTree=a.medicalTree["针灸推拿"],void 0}),a.class1="针灸推拿",a.class3="急症针灸",a.class2="针灸治疗与保健",a.class4="",a.vm={},a.vm.items=[],a.vm.columns=[{label:"名称"},{label:"一级类别"},{label:"二级类别"},{label:"三级类别"},{label:"四级类别"}],a.vm.pageSize=15,a.vm.pageNumber=0,a.vm.totalNumber=0,a.vm.pp=1,a.vm.pageList=[{label:"首页",diaplay:"disabled"},{label:"上一页",diaplay:"disabled"},{label:"下一页",diaplay:"disabled"},{label:"末页",diaplay:"disabled"}],a.gridMouseClick=function(t){e.getDetails(t).then(function(e){n.pageLoading=!1,a.datails=e.Results.Main,a.Name=e.Results.Name,$("#myModal").modal("show")})},a.showdetails=function(e,a){e&&a&&(t.generateModal(),t.triggerModal(e,a))},a.showlevel4=function(t,l,o,s,i){a.class2=l,a.class3=o,a.class4=s,a.vm.pageNumber=0,a.vm.pp=1,e.getZhongyilist(t,l,o,s,"",a.vm.pageSize,a.vm.pageNumber).then(function(e){if(void 0,n.pageLoading=!1,""!==e.Results&&void 0!==e.Results){a.vm.items=[],a.vm.totalNumber=e.Total_Zhongyi_Count,a.vm.pp=parseInt(a.vm.totalNumber/a.vm.pageSize)+1;for(var t in e.Results){var l={};l.Zid=e.Results[t][0].Zid,l.Name=e.Results[t][1].Name,l.Class1=r(e.Results[t][2].Class1),l.Class2=r(e.Results[t][3].Class2),l.Class3=r(e.Results[t][4].Class3),l.Class4=r(e.Results[t][5].Class4),a.vm.items.push(l)}}else void 0},function(e){n.pageLoading=!1,void 0})},a.showlevel4(a.class1,a.class2,a.class3,a.class4,""),a.pages=function(t){0==t?a.vm.pageNumber=0:1==t?a.vm.pageNumber<=0?a.vm.pageNumber=0:a.vm.pageNumber=a.vm.pageNumber-1:2==t?a.vm.pageNumber>=parseInt(a.vm.totalNumber/a.vm.pageSize)?a.vm.pageNumber=parseInt(a.vm.totalNumber/a.vm.pageSize):a.vm.pageNumber=a.vm.pageNumber+1:3==t&&(a.vm.pageNumber=parseInt(a.vm.totalNumber/a.vm.pageSize)),e.getZhongyilist(a.class1,a.class2,a.class3,a.class4,"",a.vm.pageSize,a.vm.pageNumber).then(function(e){if(void 0,n.pageLoading=!1,""!==e.Results&&void 0!==e.Results){a.vm.items=[],a.vm.totalNumber=e.Total_Zhongyi_Count;for(var t in e.Results){var l={};l.Zid=e.Results[t][0].Zid,l.Name=e.Results[t][1].Name,l.Class1=r(e.Results[t][2].Class1),l.Class2=r(e.Results[t][3].Class2),l.Class3=r(e.Results[t][4].Class3),l.Class4=r(e.Results[t][5].Class4),a.vm.items.push(l)}}else void 0},function(e){n.pageLoading=!1,void 0})}}]),angular.module("app").controller("AdvReaction1",AdvReaction1),angular.module("app").controller("AdvReaction2",AdvReaction2),function(){function e(e,t,a,n){var l=this;void 0,a.pageLoading=!1,l.credentials={username:"",password:""},l.returnPage=e.search().page||"/",l.onSubmit=function(){return void 0,l.formError="",l.credentials.username&&l.credentials.password?void l.getLogin():(l.formError="请输入邮箱和密码!好吗",void 0,!1)},l.getLogin=function(){l.formError="",t.loginNode(l.credentials).error(function(e){l.formError=e.message,void 0,void 0}).then(function(t){void 0,void 0,a.nodeToken=t.data.token,"normal"===t.data.auth?a.sidebarhidden=!1:"administrator"===t.data.auth&&(a.sidebarhidden=!0),void 0,void 0,e.search("page",null),e.path("/app/mkdisease")})}}angular.module("app").controller("loginCtrl",e),e.$inject=["$location","authentication","$rootScope","$http"]}(),function(){function e(e,t,a){a.pageLoading=!1;var n=this;n.credentials={name:"",email:"",password:""},n.returnPage=e.search().page||"/",n.onSubmit=function(){return void 0,n.formError="",n.credentials.name&&n.credentials.email&&n.credentials.password?void n.doRegister():(n.formError="需要填完所有字段!",!1)},n.doRegister=function(){n.formError="",t.register(n.credentials).error(function(e){n.formError=e}).then(function(){e.search("page",null),e.path(n.returnPage)})}}angular.module("app").controller("registerCtrl",e),e.$inject=["$location","authentication","$rootScope"]}(),function(){function e(e,t,a,n,l,o){var r=o.vm={};r.page={size:5,index:1},r.sort={column:"id",direction:-1,toggle:function(e){e.sortable!==!1&&(this.column===e.name?this.direction=-this.direction||-1:(this.column=e.name,this.direction=-1))}},r.Authority=["normal","administrator"],r.columns=[{label:"姓名",name:"name",type:"string"},{label:"电子邮箱",name:"email",type:"string"},{label:"权限",name:"authority",type:"string"},{label:"操作",name:"actions",sortable:!1}],r.items=[],r.ChangedItems=[],r.NewUser={},r.SelectUser={},r.ShowUsers=function(){r.formError="",void 0,void 0,a.getMyUser().error(function(e){r.formError=e.message,void 0}).then(function(e){void 0,r.items=e.data,void 0,void 0,void 0})},r.SelectedUser=function(e){r.SelectUser=e,void 0},r.PostUsers=function(){var e={};e.data=[],r.ChangedItems.forEach(function(t){var a={};a.Info=t,e.data.push(a)}),void 0,a.postMyUser(e).then(function(e){void 0}),r.ChangedItems=[]},r.DeleteUser=function(e){$(".modal-backdrop").hide(),r.items=_.reject(r.items,function(t){return e.name===t.name}),a.deleteUser(e).then(function(e){void 0})},r.ShowUsers(),r.CreateNewUser=function(){r.items.push(r.NewUser),void 0,t.register(r.NewUser).then(function(e){void 0,r.NewUser={}})},r.ShowItems=function(){void 0},r.AddChangedItems=function(e){if(0===r.ChangedItems.length)r.ChangedItems.push(e);else for(var t=0;t<r.ChangedItems.length;t++){if(e.email===r.ChangedItems[t].email){r.ChangedItems[t].authority=e.authority;break}t===r.ChangedItems.length-1&&r.ChangedItems.push(e)}},r.age=function(e){}}angular.module("app").controller("userCtrl",e),e.$inject=["$location","authentication","getUsers","$rootScope","$http","$scope"]}(),angular.module("app").filter("gridOrderBy",function(){return function(e,t,a){var n=[];return void 0,angular.forEach(e,function(e){n.push(e)}),n.sort(function(e,a){return void 0,""===a?1:""===e?-1:(void 0,void 0,"string"==typeof e[t]&&"string"===a[t]?(void 0,a[t].localeCompare(e[t])):a[t]-e[t])}),a&&n.reverse(),n}}),angular.module("app").filter("orderClass",function(){return function(e){return e===-1?"glyphicon-chevron-down":"glyphicon-chevron-up"}}),angular.module("app").filter("size",function(){return function(e){return e?e.length||0:0}}),function(){function e(){return function(e,t,a){if(!e)return[];var n=(t-1)*a,l=e.slice(n,n+a);return l}}angular.module("app").filter("paging",e)}(),angular.module("app").constant("medicineClassData",[{sclasses:[{label:"避孕药"},{label:"雌激素类及抗雌激素类药"},{label:"促性腺激素"},{label:"抗早产药"},{label:"退奶药"},{label:"外阴皮肤病用药"},{label:"雄激素类及抗雄激素类药"},{label:"孕激素类及抗孕激素类药"},{label:"中成药"},{label:"子宫收缩及引产药物"}],label:"妇产科用药"},{sclasses:[{label:"呼吸兴奋药物"},{label:"降低肺血管阻力及肺动脉高压的药物"},{label:"解热镇痛药及抗感冒药"},{label:"平喘药物"},{label:"其他"},{label:"祛痰药物"},{label:"镇咳药物"},{label:"中成药"}],label:"呼吸系统药物"},{sclasses:[{label:"过敏反应介质阻释剂"},{label:"抗组胺药"},{label:"其他类"}],label:"抗变态反应药物"},{sclasses:[{label:"氨基糖苷类"},{label:"大环内酯类"},{label:"多肽类"},{label:"磺胺类"},{label:"抗病毒药"},{label:"抗感染植物药"},{label:"抗结核药"},{label:"抗寄生虫药"},{label:"抗寄生虫药物"},{label:"抗麻风药"},{label:"抗真菌药"
},{label:"喹诺酮类"},{label:"青霉素类"},{label:"其他合成抗菌药"},{label:"其他β内酰胺类"},{label:"四环素类"},{label:"头孢菌素类"},{label:"酰胺醇类和其他"}],label:"抗生素"},{sclasses:[{label:"放疗化疗解毒剂"},{label:"骨髓功能恢复药"},{label:"激素类"},{label:"抗代谢药"},{label:"抗胃肠道不良反应药物"},{label:"抗肿瘤抗生素"},{label:"抗肿瘤植物药"},{label:"其他"},{label:"其他抗肿瘤药物"},{label:"生物反应调节剂"},{label:"烷化剂"},{label:"中成药"}],label:"抗肿瘤药物"},{sclasses:[{label:"骨骼肌松弛药"},{label:"骨骼松弛药"},{label:"解痉药"},{label:"局部麻醉用药"},{label:"全身麻醉用药"}],label:"麻醉药及其辅助药物"},{sclasses:[{label:"免疫抑制剂"},{label:"免疫增强剂"},{label:"其他"}],label:"免疫系统药物"},{sclasses:[{label:"利尿药"},{label:"前列腺增生症用药"},{label:"其他"},{label:"脱水药"},{label:"治疗男性勃起功能障碍药"},{label:"中成药"}],label:"泌尿系统药物"},{sclasses:[{label:"甲状旁腺及骨代谢疾病用药物"},{label:"甲状腺疾病用药"},{label:"肾上腺皮质激素类药"},{label:"糖尿病及胰岛疾病用药物"},{label:"痛风及高尿酸血症用药物"},{label:"下丘脑及影响内分泌的药物"},{label:"性腺疾病用药"},{label:"中成药"}],label:"内分泌系统药物"},{sclasses:[{label:"常用改善微循环的药物"},{label:"常用抗病毒药物"},{label:"常用抗麻风及麻风反应药物"},{label:"常用抗肿瘤药物"},{label:"常用维生素"},{label:"各种外用搽剂"},{label:"激素类药物"},{label:"抗结核病药"},{label:"抗寄生虫药物"},{label:"抗生素类药物"},{label:"抗炎症介质类药物"},{label:"抗真菌药物"},{label:"免疫调节剂"},{label:"其他"},{label:"中成药"}],label:"皮肤科用药"},{sclasses:[{label:"耳鼻喉及口腔科用药"},{label:"耳鼻喉科及口腔科用药"},{label:"减肥药"},{label:"解毒药"},{label:"器官功能检查诊断剂"},{label:"杀虫驱蚊灭蝇药"},{label:"外科用药及消毒防腐收敛药"},{label:"微量元素"},{label:"药用附加剂"},{label:"营养药"},{label:"诊断他用药"},{label:"诊断用药"}],label:"其他用药"},{sclasses:[{label:"菌苗"},{label:"类毒素"},{label:"酶及辅酶类"},{label:"免疫血清及血液制品"},{label:"其他"},{label:"其他类"},{label:"疫苗"}],label:"生物制品、生化药物、酶及辅酶类"},{sclasses:[{label:"解热镇痛药"},{label:"抗癫痫药物"},{label:"抗豆状核变性药"},{label:"抗焦虑药物"},{label:"抗精神、抗抑郁、抗焦虑症药物"},{label:"抗帕金森病药"},{label:"抗偏头痛药物"},{label:"抗炎镇痛药"},{label:"抗抑郁药"},{label:"抗抑郁药物"},{label:"抗原发性震颤药"},{label:"抗躁狂药"},{label:"脑血管扩张药物"},{label:"神经细胞活化剂及营养药物"},{label:"镇静及催眠药物"},{label:"镇痛药"},{label:"镇痛药物"},{label:"中成药"},{label:"中枢兴奋药物"},{label:"作用于自主神经系统的药物"},{label:"做用于自主神经系统的药物"}],label:"神经系统药物"},{sclasses:[{label:"电解质平衡调节药"},{label:"葡萄糖及其他类"},{label:"酸碱平衡调节药"}],label:"水、电解质及酸碱平衡用药"},{sclasses:[{label:"维生素A、D属药物"},{label:"维生素B属药物"},{label:"维生素C属药物及其他类"}],label:"维生素类药物"},{sclasses:[{label:"促泻药物"},{label:"肝脏疾病辅助治疗药物"},{label:"利胆药物"},{label:"其他"},{label:"胃肠解痉药物"},{label:"制酸及胃黏膜保护药"},{label:"止吐及催吐药物"},{label:"止泻药物"},{label:"中成药"},{label:"助消化药物"}],label:"消化系统药物"},{sclasses:[{label:"促白细胞药"},{label:"促凝血药"},{label:"抗凝血药"},{label:"抗贫血药物"},{label:"抗血小板药"},{label:"纤维蛋白溶解药"},{label:"血容量扩充药物"},{label:"中成药"}],label:"血液系统药物"},{sclasses:[{label:"调整血脂及抗动脉粥样硬化药物"},{label:"抗高血压药物"},{label:"抗心功能不全药物"},{label:"抗心绞痛药物"},{label:"抗心律失常药物"},{label:"抗血栓药物"},{label:"其他"},{label:"心肺复苏及抗休克药物"},{label:"心血管扩张药物"},{label:"血管扩张药物"},{label:"中成药"}],label:"循环系统药物"},{sclasses:[{label:"常用人工泪液"},{label:"促进角膜上皮再生药"},{label:"促进吸收药物"},{label:"胆碱能药物"},{label:"非甾体类消炎药"},{label:"高渗脱水剂"},{label:"抗感染"},{label:"抗肾上腺素药"},{label:"拟肾上腺素药"},{label:"前列腺素衍生物"},{label:"其他"},{label:"散瞳药物"},{label:"碳酸酐酶抑制药"},{label:"维生素类药物"},{label:"眼局部及表面麻醉药"},{label:"影响免疫功能的药物"},{label:"中成药"}],label:"眼科用药"}]).constant("labClassData",[{sclasses:[],label:"骨髓细胞学检查"},{sclasses:[{label:"垂体激素测定"},{label:"甲状旁腺激素测定"},{label:"甲状腺激素测定"},{label:"其他激素测定"},{label:"肾上腺素测定"},{label:"消化道激素测定"},{label:"性腺激素测定"},{label:"胰腺内分泌功能检查"}],label:"激素类测定"},{sclasses:[{label:"白细胞"},{label:"出血和凝血检查"},{label:"红细胞"}],label:"临床血液检查"},{sclasses:[],label:"临床血液流变学检查"},{sclasses:[{label:"细胞免疫测定"},{label:"血清补体测定"},{label:"血清免疫球蛋白测定"},{label:"自身抗体测定"}],label:"免疫学检查"},{sclasses:[{label:"粪便检查"},{label:"汗液电解质检查"},{label:"滑膜液检查"},{label:"浆膜腔穿刺液检查"},{label:"精液和前列腺液检查"},{label:"脑脊液检查"},{label:"尿液检查"},{label:"肾功能测定"},{label:"痰液检查"},{label:"唾液与泪液检查"},{label:"胃液和十二指肠引流液检查"},{label:"羊水检查"},{label:"阴道分泌物检查"}],label:"体液和排泄物检查"},{sclasses:[{label:"病毒的血清学检查"},{label:"补体结合试验"},{label:"沉淀试验"},{label:"凝集试验"},{label:"其他"},{label:"肿瘤免疫检测"}],label:"血清学检查"},{sclasses:[],label:"血细胞化学染色"},{sclasses:[{label:"氨基酸、氮化物、有机酸测定"},{label:"蛋白质测定"},{label:"酶类测定"},{label:"色素测定"},{label:"糖类测定"},{label:"血气分析"},{label:"血清维生素测定"},{label:"血液无机物测定"},{label:"脂类测定"}],label:"血液生化检查"}]).constant("diseaseClassData",[{label:"产科"},{label:"代谢科"},{label:"耳鼻喉"},{label:"儿科"},{label:"风湿科"},{label:"妇科"},{label:"肝胆外科"},{label:"感染内科"},{label:"骨科"},{label:"呼吸科"},{label:"精神科"},{label:"口腔科"},{label:"老年病科"},{label:"泌尿外科"},{label:"内分泌科"},{label:"皮肤科"},{label:"普通外科"},{label:"烧伤"},{label:"神经内科"},{label:"神经外科"},{label:"肾内科"},{label:"消化科"},{label:"心血管内科"},{label:"胸外科"},{label:"血液科"},{label:"眼科"},{label:"肿瘤科"}]).constant("diagnosisClassData",[{sclasses:[],label:"成瘾医学科"},{sclasses:[],label:"传染科"},{sclasses:[],label:"儿科"},{sclasses:[{label:"产科"},{label:"妇科"}],label:"妇产科"},{sclasses:[{label:"肝炎"}],label:"肝病"},{sclasses:[],label:"核医学科"},{sclasses:[{label:"精神病科"},{label:"心理咨询"}],label:"精神心理科"},{sclasses:[],label:"急诊科"},{sclasses:[],label:"老年科"},{sclasses:[],label:"男科"},{sclasses:[{label:"风湿科"},{label:"呼吸内科"},{label:"内分泌科"},{label:"神经内科"},{label:"肾内科"},{label:"消化内科"},{label:"心血管内科"},{label:"血液科"}],label:"内科"},{sclasses:[{label:"皮肤科"},{label:"性病科"}],label:"皮肤性病"},{sclasses:[],label:"生殖健康"},{sclasses:[],label:"体检保健科"},{sclasses:[{label:"肝胆外科"},{label:"肛肠外科"},{label:"骨科"},{label:"泌尿外科"},{label:"脑外科"},{label:"普外科"},{label:"器官移植"},{label:"乳腺外科"},{label:"烧伤科"},{label:"手外科"},{label:"外伤科"},{label:"胃肠外科"},{label:"心胸外科"},{label:"血管外科"}],label:"外科"},{sclasses:[{label:"耳鼻喉科"},{label:"口腔科"},{label:"眼科"}],label:"五官科"},{sclasses:[],label:"营养科"},{sclasses:[],label:"肿瘤科"},{sclasses:[{label:"中医科"}],label:"中西医结合科"}]).constant("bodyData",[{sbodies:[],label:"背部"},{sbodies:[{label:"肠"},{label:"肠系膜"},{label:"胆"},{label:"腹膜"},{label:"肝"},{label:"阑尾"},{label:"脾"},{label:"胃"},{label:"胰腺"}],label:"腹部"},{sbodies:[{label:"关节"},{label:"骨髓"},{label:"脊髓"},{label:"脊柱"},{label:"肋骨"},{label:"颅骨"},{label:"盆骨"},{label:"其他骨"},{label:"上肢骨"},{label:"下肢骨"}],label:"骨"},{sbodies:[],label:"会阴部"},{sbodies:[{label:"甲状腺"},{label:"气管"}],label:"颈部"},{sbodies:[{label:"睾丸"},{label:"前列腺"},{label:"输精管"},{label:"阴茎"},{label:"阴囊"}],label:"男性生殖"},{sbodies:[{label:"卵巢"},{label:"输卵管"},{label:"外阴"},{label:"阴道"},{label:"子宫"}],label:"女性生殖"},{sbodies:[{label:"膀胱"},{label:"尿道"}],label:"盆腔"},{sbodies:[],label:"其他"},{sbodies:[{label:"肌肉"},{label:"淋巴"},{label:"免疫系统"},{label:"皮肤"},{label:"血液血管"},{label:"周围神经系统"}],label:"全身"},{sbodies:[{label:"肩部"},{label:"前臂"},{label:"上臂"},{label:"手部"},{label:"肘部"}],label:"上肢"},{sbodies:[{label:"鼻"},{label:"耳"},{label:"口"},{label:"颅脑"},{label:"面部"},{label:"眼"},{label:"咽喉"}],label:"头部"},{sbodies:[{label:"肛门"}],label:"臀部"},{sbodies:[{label:"大腿"},{label:"小腿"},{label:"膝部"},{label:"足部"}],label:"下肢"},{sbodies:[],label:"心理"},{sbodies:[{label:"肺"},{label:"膈肌"},{label:"乳房"},{label:"食管"},{label:"心脏"},{label:"纵膈"}],label:"胸部"},{sbodies:[{label:"肾"},{label:"肾上腺"},{label:"输尿管"}],label:"腰部"}]).constant("windownSize",function(){void 0}),angular.module("app").service("Data",["$http","$q","$rootScope",function(e,t,a){return{getPatientByID:function(t){var a={PID:t};a={path:"/patientQuery",params:a};var n=e({method:"GET",url:"http://59.110.52.133:3010/api/transfer",params:{q:JSON.stringify(a)}}).then(function(e){return void 0,void 0,1!==e.data.Return&&void 0,e.data});return n},getPid:function(t){var a={Cid:t};a={path:"/usdata/getPatient",params:a};var n=e({method:"GET",url:"http://59.110.52.133:3010/api/transfer",params:{q:JSON.stringify(a)}}).then(function(e){return void 0,void 0,e.data});return n},getSankeyData:function(e,t){var a={};a.PID=e,a.TOP=t||10,a={path:"/PatientSimilarity",params:a};var n=JSON.stringify(a),l={q:n};void 0;var o=$.ajax({type:"GET",url:"http://59.110.52.133:3010/api/transfer",data:l,dataType:"json",success:function(e){return void 0,void 0,1!==e.return&&void 0,e}});return o},getSankeyMedData:function(e,t){var a={};a.PID=e,a.TOP=t||5,a={path:"/usdata/similarPatientMedication",params:a};var n=JSON.stringify(a),l={q:n},o=$.ajax({type:"GET",url:"http://59.110.52.133:3010/api/transfer",data:l,dataType:"json",success:function(e){return void 0,void 0,0!==e.return&&void 0,e}});return o},getNetworkStyle:function(){var t=e.get("data/style_test.txt").then(function(e){return e.data});return t},getNetworkData:function(t){var a={NID:t};void 0,void 0,a={path:"/getNodesInfo/",params:a};var n=e({method:"POST",headers:{"Content-Type":"application/json"},url:"http://59.110.52.133:3010/api/transfer",data:JSON.stringify(a)}).error(function(e){void 0,void 0}).success(function(e){void 0,void 0,0!==e.return&&void 0});return n},getFilterData:function(t){var a=t||{filterbydomain:"dis",filterbyfirst:"",filterbyfclass:"",filterbysclass:"",filterbyfbody:"",filterbysbody:"",filterbynumber:"10"};void 0,void 0,a={path:"/getQueryOut/",params:a};var n=e({method:"POST",headers:{"Content-Type":"application/json"},url:"http://59.110.52.133:3010/api/transfer",data:JSON.stringify(a)}).then(function(e){return void 0,void 0,0!==e.data.return&&void 0,e.data});return n},getDiseaseIds:function(t){var a=t||{AND:["m12767","m12754"],NOT:["l1087"]};void 0,void 0,a={path:"/getDisOut/",params:a},void 0;var n=e({method:"POST",headers:{"Content-Type":"application/json"},url:"http://59.110.52.133:3010/api/transfer",data:JSON.stringify(a)}).then(function(e){return void 0,void 0,void 0,e.data});return n},getMedicineIds:function(t){var a=t||{AND:["m12767","m12754"],NOT:["l1087"]};void 0,void 0,a={path:"/getMedOut/",params:a};var n=e({method:"POST",headers:{"Content-Type":"application/json"},url:"http://59.110.52.133:3010/api/transfer",data:JSON.stringify(a)}).then(function(e){return void 0,void 0,e.data});return n},getDisRelation:function(a){var n=a||{DIDS:["d41311","d42983","d38428"]};t.defer();void 0,void 0,n={path:"/getDisRelation/",params:n};var l=e({method:"POST",headers:{"Content-Type":"application/json"},url:"http://59.110.52.133:3010/api/transfer",data:JSON.stringify(n)}).success(function(e){void 0,void 0}).error(function(e,t,a,n){void 0});return l},getMedRelation:function(t){var a=t||{MIDS:["m12767","m12754"]};void 0,void 0,a={path:"/getMedRelation/",params:a};var n=e({method:"POST",headers:{"Content-Type":"application/json"},url:"http://59.110.52.133:3010/api/transfer",data:JSON.stringify(a)}).success(function(e){void 0,void 0}).error(function(e){void 0});return n}}}]),angular.module("app").service("SPDiagnosisSharedDataService",["Data",function(e){function t(e,t){n[e]=t}function a(){return n}var n={};return{addData:t,getData:a}}]),angular.module("app").service("SPMedicationSharedDataService",["Data",function(e){function t(e,t){n[e]=t}function a(){return n}var n={};return{addData:t,getData:a}}]),angular.module("app").factory("httpReject",["$rootScope",function(e){var t={request:function(t){return e.errorModal&&(t.requestTimestamp={requestTimestamp:e.errorModal.apiTimestamp}),$("#errorModal").on("hidden.bs.modal",function(a){1===e.errorModal.isWaitingForAPI&&("http://123.56.119.197:9999/getDisOut/"==t.url,e.errorModal.unneededAPI={apiTimestamp:e.errorModal.apiTimestamp},e.errorModal.isWaitingForAPI=0)}),t},response:function(t){return e.errorModal&&(e.errorModal.isWaitingForAPI=0),t.config.requestTimestamp&&t.config.requestTimestamp.requestTimestamp&&t.config.requestTimestamp.requestTimestamp==e.errorModal.unneededAPI.apiTimestamp&&(t.data=null,t.status=0,t.statusText="",t.unneeded=1),t}};return t}]),angular.module("app").service("traMedical",["$q","$http","$rootScope",function(e,t,a){return{getAllList:function(){var a=e.defer(),n={Table:"Zhongyi",Id:"z0000000"};return n={path:"/medknowledge/zhongyiop",params:n},t({method:"GET",url:"http://59.110.52.133:3010/api/transfer",params:{q:JSON.stringify(n)}}).success(function(e,t,n,l){a.resolve(e),void 0}).error(function(e,t,n,l){a.reject()}),a.promise},getZhongyilist:function(a,n,l,o,r,s,i){var c=e.defer(),d=i*s,u=(i+1)*s,g={Table:"Zhongyi",Id:"z0000000",Sort_item:"Name"};g.Start=d,g.End=u;var p={class1:a,class2:n,class3:l,class4:o,class5:r};return g.Filter=p,g={path:"/medknowledge/zhongyilist",params:g},t({method:"GET",url:"http://59.110.52.133:3010/api/transfer",params:{q:JSON.stringify(g)}}).success(function(e,t,a,n){c.resolve(e),void 0}).error(function(e,t,a,n){c.reject()}),c.promise},getDetails:function(a){var n=e.defer(),l={Table:"Zhongyi",Id:a};return l={path:"/medknowledge/zhongyiop",params:l},t({method:"GET",url:"http://59.110.52.133:3010/api/transfer",params:{q:JSON.stringify(l)}}).success(function(e,t,a,l){void 0,n.resolve(e),void 0}).error(function(e,t,a,l){n.reject()}),n.promise}}}]),function(){function e(e,t,a){var n=function(t){e.localStorage["read-token"]=t},l=function(){return e.localStorage["read-token"]},o=function(e){return t.post("http://59.110.52.133:3010/api/register",e).success(function(e){n(e.token)})},r=function(e){return void 0,void 0,t.post("http://59.110.52.133:3010/api/login",e).success(function(e){n(e.token)})},s=function(){e.localStorage.removeItem("read-token")},i=function(){var t=l();if(t){var a=JSON.parse(e.atob(t.split(".")[1]));return a.exp>Date.now()/1e3}return!1},c=function(){if(i()){var t=l(),a=JSON.parse(e.atob(t.split(".")[1]));return{email:a.email,name:a.name}}};return{saveToken:n,getToken:l,register:o,loginNode:r,logout:s,isLoggedIn:i,currentUser:c}}angular.module("app").service("authentication",e),e.$inject=["$window","$http","$rootScope"]}(),function(){function e(e,t,a){var n=function(){return t.get("http://59.110.52.133:3010/api/getuser").success(function(e){void 0})},l=function(e){return t.post("http://59.110.52.133:3010/api/postuser",e).success(function(){void 0})},o=function(e){return t.post("http://59.110.52.133:3010/api/deleteuser",e).success(function(){void 0})};return{getMyUser:n,postMyUser:l,deleteUser:o}}angular.module("app").service("getUsers",e),e.$inject=["$window","$http","$rootScope"]}(),function(){function e(e,t,a){function n(t,a){e.showMKModal(t,a)}function l(){function n(){var n=l[l.length-1],r=n[0],s=n[1];a.get('http://59.110.52.133:3010/api/transfer/?q={"path":"/medknowledge/op","params":{%22Table%22:%22'+r+"%22,%22Id%22:%22"+s+"%22}}").success(function(a){var n,r,s,i,c,d,u,g,p,m,h,f=a.Results,v="",b=200,y=[];void 0,n=e.modal={title:f.Name,table:f.Table,content:f.Content,isBackShow:!0,isForwardShow:!0,pdf:f.Pdf,video:f.Video,type:f.Type,isNavShow:!0},"Evidence"!==n.type&&"Clinicalg"!==n.type&&"Video"!==n.type&&"Otherres"!==n.type||(n.isNavShow=!1),0===o&&(n.isBackShow=!1),o===l.length-1&&(n.isForwardShow=!1),void 0,n.list=n.content,void 0,void 0,"Video"===n.type&&(v+="<div class='spinner'></div>",v+="<video src='http://1.85.37.136:9999/medknowledge/videoop/?q={%22Table%22:%22Video%22,%22Vid%22:%22"+n.video+"%22}' width = '100%'  controls preload></video>");for(r in n.list)if(("temp"!==r||0!==n.list[r].length)&&n.list.hasOwnProperty(r))for(v+="<h3 style='color: #3c8dbc;' id='"+r+"'>"+r+"</h3>",s=n.list[r],void 0,c=0,g=s.length;c<g;c++){if(void 0,0===s[c][0])v+=s[c][1];else if(1===s[c][0])v+="<a ng-click=\"showMKModalWithString('"+s[c][2]+"')\">"+s[c][1]+"</a>";else if(9===s[c][0])v+="</br>"+s[c][1]+"<br>";else if(10===s[c][0])v+="</br>";else if(2===s[c][0])v+="</br>",0!==s[c][2]&&(b=s[c][2]),0!==s[c][3]&&(b=s[c][3]),p=s[c][1].split("/"),m="http://1.85.37.136:9999/medknowledge/imageop/?q={%22Iid%22:%22"+p[1]+"%22}",v+="Clinicalg"===n.type?"<div><img alt='User Image' src="+m+" style='width: 100%'/></div>":"<div><img alt='User Image' src="+m+"></div>",v+="</br>";else if(8===s[c][0])for(v+="<table class='table table-bordered table-striped'><thead><tr><th>可能疾病</th><th>伴随症状</th><th>就诊科室</th></tr></thead><tbody>",i=s[c][1],void 0,d=0;d<i.length;d++){for(y[0]=i[d]["可能疾病"],y[1]=i[d]["伴随症状"],y[2]=i[d]["就诊科室"],v+="<tr><th><a ng-click=\"showMKModalWithString('"+y[0].Id+"')\">"+y[0].Name+"</a></th><th>  ",u=0;u<y[1].length;u++)v+="<a ng-click=\"showMKModalWithString('"+y[1][u].Id+"')\">&nbsp;"+y[1][u].Name+"&nbsp;</a>";v+="  </th><th>"+y[2]+"</th></tr>"}else"table"===s[c][0]&&(v+=s[c][1]);c===g-1&&(v+="<p></p>")}void 0,void 0,angular.element("#modalText").html(t(v)(e)),$("#medicalKnowledgeModal").modal("show"),"Video"===n.type&&(h=$("VIDEO"),h[0].addEventListener("canplaythrough",function(){$(".spinner").removeClass("spinner")}),$("#medicalKnowledgeModal").on("hidden.bs.modal",function(){h[0].pause()}))})}var l=[],o=0;void 0,e.showMKModal=function(e,t){l.push([e,t]),o=l.length-1,void 0,void 0,n()},e.showMKModalWithString=function(t){var a=t.split("/");void 0,e.showMKModal(a[0],a[1])},e.mkModalCrl={},e.showMKModalBack=function(){o--,l.push(l[o]),n()},e.showMKModalForward=function(){o++,l.push(l[o]),n()}}return{generateModal:l,triggerModal:n}}e.$inject=["$rootScope","$compile","$http"],angular.module("app").service("medicalKnowledgeModal",e)}(),angular.module("app").controller("searchStartController",searchStartController);